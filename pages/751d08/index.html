<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL的存储引擎和索引 | 软件设计师</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/exam/img/lu.png">
    <script src="https://cdn.wwads.cn/js/makemoney.js" type="text/javascript"></script>
    <meta name="description" content="一分耕耘一分收获">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <meta name="wwads-cn-verify" content="6c4b761a28b734fe93831e3fb400ce87">
    
    <link rel="preload" href="/exam/assets/css/0.styles.f3b4b6de.css" as="style"><link rel="preload" href="/exam/assets/js/app.1e2999bd.js" as="script"><link rel="preload" href="/exam/assets/js/2.d32ca216.js" as="script"><link rel="preload" href="/exam/assets/js/19.34a4f0df.js" as="script"><link rel="prefetch" href="/exam/assets/js/10.5265ff2b.js"><link rel="prefetch" href="/exam/assets/js/11.c4c5207e.js"><link rel="prefetch" href="/exam/assets/js/12.31cb3d76.js"><link rel="prefetch" href="/exam/assets/js/13.a47857df.js"><link rel="prefetch" href="/exam/assets/js/14.72c28a89.js"><link rel="prefetch" href="/exam/assets/js/15.ad243f17.js"><link rel="prefetch" href="/exam/assets/js/16.97612ac7.js"><link rel="prefetch" href="/exam/assets/js/17.3bbe13d7.js"><link rel="prefetch" href="/exam/assets/js/18.d9d73fe7.js"><link rel="prefetch" href="/exam/assets/js/20.c88c1497.js"><link rel="prefetch" href="/exam/assets/js/21.e8d03c9a.js"><link rel="prefetch" href="/exam/assets/js/22.184ebafa.js"><link rel="prefetch" href="/exam/assets/js/23.12e5d7bb.js"><link rel="prefetch" href="/exam/assets/js/24.75c21041.js"><link rel="prefetch" href="/exam/assets/js/25.b16f0127.js"><link rel="prefetch" href="/exam/assets/js/26.6eb9f6b7.js"><link rel="prefetch" href="/exam/assets/js/27.67156c7f.js"><link rel="prefetch" href="/exam/assets/js/28.283d5b83.js"><link rel="prefetch" href="/exam/assets/js/29.6c223534.js"><link rel="prefetch" href="/exam/assets/js/3.d4e4ad20.js"><link rel="prefetch" href="/exam/assets/js/30.3ab6b5f1.js"><link rel="prefetch" href="/exam/assets/js/31.f6351d7c.js"><link rel="prefetch" href="/exam/assets/js/32.c00850fd.js"><link rel="prefetch" href="/exam/assets/js/33.8b737bc5.js"><link rel="prefetch" href="/exam/assets/js/34.7be2aaf1.js"><link rel="prefetch" href="/exam/assets/js/35.5a82d7a0.js"><link rel="prefetch" href="/exam/assets/js/36.4c249e67.js"><link rel="prefetch" href="/exam/assets/js/37.c174f7fd.js"><link rel="prefetch" href="/exam/assets/js/38.646d4869.js"><link rel="prefetch" href="/exam/assets/js/39.8dd73816.js"><link rel="prefetch" href="/exam/assets/js/4.e0a9a322.js"><link rel="prefetch" href="/exam/assets/js/40.31d7e137.js"><link rel="prefetch" href="/exam/assets/js/41.4ad90edf.js"><link rel="prefetch" href="/exam/assets/js/42.2add84ff.js"><link rel="prefetch" href="/exam/assets/js/43.1dbdb1b5.js"><link rel="prefetch" href="/exam/assets/js/44.24c08607.js"><link rel="prefetch" href="/exam/assets/js/45.5c60b648.js"><link rel="prefetch" href="/exam/assets/js/46.b064deb5.js"><link rel="prefetch" href="/exam/assets/js/47.2d070dc3.js"><link rel="prefetch" href="/exam/assets/js/48.dc471c3e.js"><link rel="prefetch" href="/exam/assets/js/49.b4b24af2.js"><link rel="prefetch" href="/exam/assets/js/5.8fbef9e7.js"><link rel="prefetch" href="/exam/assets/js/50.3fb90a34.js"><link rel="prefetch" href="/exam/assets/js/51.f2bdb144.js"><link rel="prefetch" href="/exam/assets/js/52.dd18e9d0.js"><link rel="prefetch" href="/exam/assets/js/53.f4632fce.js"><link rel="prefetch" href="/exam/assets/js/54.5017f6c8.js"><link rel="prefetch" href="/exam/assets/js/55.ba8e398b.js"><link rel="prefetch" href="/exam/assets/js/56.a325fb91.js"><link rel="prefetch" href="/exam/assets/js/57.b5197f62.js"><link rel="prefetch" href="/exam/assets/js/58.84caf0c9.js"><link rel="prefetch" href="/exam/assets/js/59.74de2f49.js"><link rel="prefetch" href="/exam/assets/js/6.a2544676.js"><link rel="prefetch" href="/exam/assets/js/60.ffc6d104.js"><link rel="prefetch" href="/exam/assets/js/7.a3bbed7a.js"><link rel="prefetch" href="/exam/assets/js/8.813850a9.js"><link rel="prefetch" href="/exam/assets/js/9.f7c583ac.js">
    <link rel="stylesheet" href="/exam/assets/css/0.styles.f3b4b6de.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/exam/" class="home-link router-link-active"><img src="/exam/img/deer.png" alt="软件设计师" class="logo"> <span class="site-name can-hide">软件设计师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/exam/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/exam/pages/f015b6/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/exam/pages/8d7d6e/" class="nav-link">1.文档介绍</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f015b6/" class="nav-link">2.学习路线规划</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/0ca117/" class="nav-link">3.计算机系统与网络</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/454a1c/" class="nav-link">4.数据库</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/beda9a/" class="nav-link">5.程序语言设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f5abb7/" class="nav-link">6.面向对象设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/2bb75b/" class="nav-link">7.数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/9e10e0/" class="nav-link">8.知识产权</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/52aecc/" class="nav-link">9.软件工程</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f43aaa/" class="nav-link">10.UML</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/fb9639/" class="nav-link">11.数据流图</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/91b2e7/" class="nav-link">12.数据库设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/55dfda/" class="nav-link">13.Java设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="思维导图" class="dropdown-title"><a href="/exam/pages/fb6ad7/" class="link-title">思维导图</a> <span class="title" style="display:none;">思维导图</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/exam/pages/64d804/" class="nav-link">思维导图复习导航</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/fb6ad7/" class="nav-link">计算机结构思维导图</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/0751c5/" class="nav-link">复习大纲笔记</a></li></ul></div></div><div class="nav-item"><a href="/exam/pages/db78e2/" class="nav-link">资源</a></div><div class="nav-item"><a href="/exam/pages/1b12ed/" class="nav-link">💖支持</a></div> <a href="https://github.com/Kryust/exam" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/exam/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><a href="/exam/pages/f015b6/" class="link-title">指南</a> <span class="title" style="display:none;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/exam/pages/8d7d6e/" class="nav-link">1.文档介绍</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f015b6/" class="nav-link">2.学习路线规划</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/0ca117/" class="nav-link">3.计算机系统与网络</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/454a1c/" class="nav-link">4.数据库</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/beda9a/" class="nav-link">5.程序语言设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f5abb7/" class="nav-link">6.面向对象设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/2bb75b/" class="nav-link">7.数据结构与算法</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/9e10e0/" class="nav-link">8.知识产权</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/52aecc/" class="nav-link">9.软件工程</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/f43aaa/" class="nav-link">10.UML</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/fb9639/" class="nav-link">11.数据流图</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/91b2e7/" class="nav-link">12.数据库设计</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/55dfda/" class="nav-link">13.Java设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="思维导图" class="dropdown-title"><a href="/exam/pages/fb6ad7/" class="link-title">思维导图</a> <span class="title" style="display:none;">思维导图</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/exam/pages/64d804/" class="nav-link">思维导图复习导航</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/fb6ad7/" class="nav-link">计算机结构思维导图</a></li><li class="dropdown-item"><!----> <a href="/exam/pages/0751c5/" class="nav-link">复习大纲笔记</a></li></ul></div></div><div class="nav-item"><a href="/exam/pages/db78e2/" class="nav-link">资源</a></div><div class="nav-item"><a href="/exam/pages/1b12ed/" class="nav-link">💖支持</a></div> <a href="https://github.com/Kryust/exam" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开篇介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/8d7d6e/" class="sidebar-link">文档系统介绍</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>学习路线规划</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/f015b6/" class="sidebar-link">软考学习路线规划</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>计算机系统与网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/0ca117/" class="sidebar-link">计算机组成与体系结构</a></li><li><a href="/exam/pages/1581f4/" class="sidebar-link">操作系统基本原理</a></li><li><a href="/exam/pages/fd02ba/" class="sidebar-link">计算机网络</a></li><li><a href="/exam/pages/b49e95/" class="sidebar-link">网络信息安全</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/454a1c/" class="sidebar-link">数据库系统</a></li><li><a href="/exam/pages/b3d4fe/" class="sidebar-link">MySQL概述</a></li><li><a href="/exam/pages/4d8727/" class="sidebar-link">MySQL安装</a></li><li><a href="/exam/pages/972c8f/" class="sidebar-link">MySQL的SQL详解</a></li><li><a href="/exam/pages/7bb5a9/" class="sidebar-link">MySQL的函数</a></li><li><a href="/exam/pages/c2207f/" class="sidebar-link">MySQL的约束</a></li><li><a href="/exam/pages/7cdfba/" class="sidebar-link">MySQL多表查询</a></li><li><a href="/exam/pages/904c55/" class="sidebar-link">MySQL的事务</a></li><li><a href="/exam/pages/751d08/" aria-current="page" class="active sidebar-link">MySQL的存储引擎和索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/exam/pages/751d08/#_1-1-mysql体系结构" class="sidebar-link">1.1 MySQL体系结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_1-2-存储引擎介绍" class="sidebar-link">1.2 存储引擎介绍</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_1-3-存储引擎特点" class="sidebar-link">1.3 存储引擎特点</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_1-3-1-innodb" class="sidebar-link">1.3.1 InnoDB</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_1-3-2-myisam" class="sidebar-link">1.3.2 MyISAM</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_1-3-3-memory" class="sidebar-link">1.3.3 Memory</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_1-3-4-区别及特点" class="sidebar-link">1.3.4 区别及特点</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_1-4-存储引擎选择" class="sidebar-link">1.4 存储引擎选择</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/exam/pages/751d08/#_2-索引" class="sidebar-link">2. 索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_2-1-索引概述" class="sidebar-link">2.1 索引概述</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-1-1-介绍" class="sidebar-link">2.1.1 介绍</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-3-特点" class="sidebar-link">2.3 特点</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_2-2-索引结构" class="sidebar-link">2.2 索引结构</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-2-1-概述" class="sidebar-link">2.2.1 概述</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-2-2-二叉树" class="sidebar-link">2.2.2 二叉树</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-2-3-b-tree" class="sidebar-link">2.2.3 B-Tree</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-2-4-b-tree" class="sidebar-link">2.2.4 B+Tree</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-2-5-hash" class="sidebar-link">2.2.5 Hash</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_2-3-索引分类" class="sidebar-link">2.3 索引分类</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-3-1-索引分类" class="sidebar-link">2.3.1 索引分类</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-3-2-聚集索引-二级索引" class="sidebar-link">2.3.2 聚集索引&amp;二级索引</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_2-4-索引语法" class="sidebar-link">2.4 索引语法</a></li><li class="sidebar-sub-header level3"><a href="/exam/pages/751d08/#_2-5-sql性能分析" class="sidebar-link">2.5 SQL性能分析</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-5-1-sql执行频率" class="sidebar-link">2.5.1 SQL执行频率</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-5-2-慢查询日志" class="sidebar-link">2.5.2 慢查询日志</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-5-3-profile详情" class="sidebar-link">2.5.3 profile详情</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-5-4-explain" class="sidebar-link">2.5.4 explain</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-6-索引使用" class="sidebar-link">2.6 索引使用</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-1-验证索引效率" class="sidebar-link">2.6.1 验证索引效率</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-2-最左前缀法则" class="sidebar-link">2.6.2 最左前缀法则</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-3-范围查询" class="sidebar-link">2.6.3 范围查询</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-4-索引失效情况" class="sidebar-link">2.6.4 索引失效情况</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-5-sql提示" class="sidebar-link">2.6.5 SQL提示</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-6-覆盖索引" class="sidebar-link">2.6.6 覆盖索引</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-7-前缀索引" class="sidebar-link">2.6.7 前缀索引</a></li><li class="sidebar-sub-header level5"><a href="/exam/pages/751d08/#_2-6-8-单列索引与联合索引" class="sidebar-link">2.6.8 单列索引与联合索引</a></li><li class="sidebar-sub-header level4"><a href="/exam/pages/751d08/#_2-7-索引设计原则" class="sidebar-link">2.7 索引设计原则</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面向对象</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/f5abb7/" class="sidebar-link">Java面向对象(上)</a></li><li><a href="/exam/pages/a5fd33/" class="sidebar-link">Java面对对象(下)</a></li><li><a href="/exam/pages/d7dcc5/" class="sidebar-link">面向对象设计总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/2bb75b/" class="sidebar-link">数据结构基本概念</a></li><li><a href="/exam/pages/a46aa1/" class="sidebar-link">线性表</a></li><li><a href="/exam/pages/6e4306/" class="sidebar-link">堆栈</a></li><li><a href="/exam/pages/3e284b/" class="sidebar-link">队列</a></li><li><a href="/exam/pages/925cd5/" class="sidebar-link">树的定义</a></li><li><a href="/exam/pages/75c23c/" class="sidebar-link">二叉树的遍历</a></li><li><a href="/exam/pages/a7d8d3/" class="sidebar-link">二叉查找树</a></li><li><a href="/exam/pages/bf255e/" class="sidebar-link">平衡二叉树</a></li><li><a href="/exam/pages/830399/" class="sidebar-link">堆</a></li><li><a href="/exam/pages/41b93a/" class="sidebar-link">哈夫曼树</a></li><li><a href="/exam/pages/9640b5/" class="sidebar-link">图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>知识产权</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/9e10e0/" class="sidebar-link">知识产权标准化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>程序语言设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/beda9a/" class="sidebar-link">程序语言设计(上)</a></li><li><a href="/exam/pages/76f52a/" class="sidebar-link">程序设计语言(下)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>软件工程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/52aecc/" class="sidebar-link">软件工程基础知识</a></li><li><a href="/exam/pages/4e3563/" class="sidebar-link">软件工程题目</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>UML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/f43aaa/" class="sidebar-link">UML概述</a></li><li><a href="/exam/pages/3cb6ac/" class="sidebar-link">UML详解</a></li><li><a href="/exam/pages/9bf5f0/" class="sidebar-link">14种UML图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据流图</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/fb9639/" class="sidebar-link">数据流图详解</a></li><li><a href="/exam/pages/70e421/" class="sidebar-link">数据流图答题技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库设计</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/91b2e7/" class="sidebar-link">数据库设计</a></li><li><a href="/exam/pages/1575d1/" class="sidebar-link">数据流设计答题技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/exam/pages/55dfda/" class="sidebar-link">Java设计模式笔记</a></li><li><a href="/exam/pages/5aa53b/" class="sidebar-link">Java设计模式下午题目</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/exam/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>指南</span></li><li data-v-06225672><span data-v-06225672>数据库</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/Kryust" target="_blank" title="作者" class="beLink" data-v-06225672>ZYH</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-06-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">MySQL的存储引擎和索引<!----></h1> <div class="page-slot page-slot-top">
    <div class="wwads-cn wwads-horizontal page-wwads" data-id="136"></div>
    <style>
      .page-wwads{
        width:100%!important;
        min-height: 0;
        margin: 0;
      }
      .page-wwads .wwads-img img{
        width:80px!important;
      }
      .page-wwads .wwads-poweredby{
        width: 40px;
        position: absolute;
        right: 25px;
        bottom: 3px;
      }
      .wwads-content .wwads-text, .page-wwads .wwads-text{
        height: 100%;
        padding-top: 5px;
        display: block;
      }
  </style>
  </div> <div class="theme-vdoing-content content__default"><h1 id="存储引擎和索引"><a href="#存储引擎和索引" class="header-anchor">#</a> 存储引擎和索引</h1> <h2 id="_1-1-mysql体系结构"><a href="#_1-1-mysql体系结构" class="header-anchor">#</a> 1.1 MySQL体系结构</h2> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842119.png" alt="image-20220630234931596"></p> <p><strong>1). 连接层</strong></p> <p><code>最上层是一些客户端和链接服务，包含本地sock 通信和大多数基于客户端/服务端工具实现的类似于TCP/IP的通信。</code>主要完成一些类似于连接处理、授权认证、及相关的安全方案。在该层上引入了线程池的概念，为通过认证安全接入的客户端提供线程。同样在该层上可以实现基于SSL的安全链接。服务器也会为安全接入的每个客户端验证它所具有的操作权限。</p> <p><strong>2). 服务层</strong></p> <p><code>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。</code>所有跨存储引擎的功能也在这一层实现，如 过程、函数等。在该层，服务器会解析查询并创建相应的内部解析树，并对其完成相应的优化如确定表的查询的顺序，是否利用索引等，最后生成相应的执行操作。如果是select语句，服务器还会查询内部的缓存，如果缓存空间足够大，这样在解决大量读操作的环境中能够很好的提升系统的性能。</p> <p><strong>3). 引擎层</strong></p> <p><code>存储引擎层， 存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。</code>不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。数据库中的索引是在存储引擎层实现的。</p> <p><strong>4). 存储层</strong></p> <p>数据存储层， 主要是将数据(如: redolog、undolog、数据、索引、二进制日志、错误日志、查询日志、慢查询日志等)存储在文件系统之上，并完成与存储引擎的交互。</p> <p>和其他数据库相比，MySQL有点与众不同，它的架构可以在多种不同场景中应用并发挥良好作用。主要体现在存储引擎上，插件式的存储引擎架构，将查询处理和其他的系统任务以及数据的存储提取分离。</p> <p>这种架构可以根据业务的需求和实际需要选择合适的存储引擎。</p> <h3 id="_1-2-存储引擎介绍"><a href="#_1-2-存储引擎介绍" class="header-anchor">#</a> 1.2 存储引擎介绍</h3> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842406.png" alt="image-20220630235031538"></p> <p>大家可能没有听说过存储引擎，但是一定听过引擎这个词，引擎就是发动机，是一个机器的核心组件。比如，对于舰载机、直升机、火箭来说，他们都有各自的引擎，是他们最为核心的组件。而我们在选择引擎的时候，需要在合适的场景，选择合适的存储引擎，就像在直升机上，我们不能选择舰载机的引擎一样。</p> <p>而对于存储引擎，也是一样，他是mysql数据库的核心，我们也需要在合适的场景选择合适的存储引擎。接下来就来介绍一下存储引擎。</p> <p>存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式 。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。我们可以在创建表的时候，来指定选择的存储引擎，如果没有指定将自动选择默认的存储引擎。</p> <p>1.建表时指定存储引擎</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">'表名'</span><span class="token punctuation">(</span>
    字段<span class="token number">1</span> 字段<span class="token number">1</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMIT</span> 字段<span class="token number">1</span>注释<span class="token punctuation">]</span><span class="token punctuation">,</span>
    字段<span class="token number">2</span> 字段<span class="token number">3</span>类型 <span class="token punctuation">[</span><span class="token keyword">COMMIT</span> 字段<span class="token number">3</span>注释<span class="token punctuation">]</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token punctuation">[</span><span class="token keyword">COMMIT</span> 表注释<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>2.查询当前数据库支持的存储引擎</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> engines<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token operator">|</span> <span class="token keyword">Engine</span>             <span class="token operator">|</span> Support <span class="token operator">|</span> <span class="token keyword">Comment</span>                                                                                         <span class="token operator">|</span> <span class="token keyword">Transactions</span> <span class="token operator">|</span> XA   <span class="token operator">|</span> Savepoints <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token operator">|</span> CSV                <span class="token operator">|</span> YES     <span class="token operator">|</span> Stores <span class="token keyword">tables</span> <span class="token keyword">as</span> CSV files                                                                      <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MRG_MyISAM         <span class="token operator">|</span> YES     <span class="token operator">|</span> Collection <span class="token keyword">of</span> identical MyISAM <span class="token keyword">tables</span>                                                           <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MEMORY             <span class="token operator">|</span> YES     <span class="token operator">|</span> <span class="token keyword">Hash</span> based<span class="token punctuation">,</span> stored <span class="token operator">in</span> memory<span class="token punctuation">,</span> useful <span class="token keyword">for</span> <span class="token keyword">temporary</span> <span class="token keyword">tables</span>                                       <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> Aria               <span class="token operator">|</span> YES     <span class="token operator">|</span> Crash<span class="token operator">-</span>safe <span class="token keyword">tables</span> <span class="token keyword">with</span> MyISAM heritage<span class="token punctuation">.</span> Used <span class="token keyword">for</span> internal <span class="token keyword">temporary</span> <span class="token keyword">tables</span> <span class="token operator">and</span> privilege <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MyISAM             <span class="token operator">|</span> YES     <span class="token operator">|</span> Non<span class="token operator">-</span>transactional <span class="token keyword">engine</span> <span class="token keyword">with</span> good performance <span class="token operator">and</span> small <span class="token keyword">data</span> footprint                         <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> SEQUENCE           <span class="token operator">|</span> YES     <span class="token operator">|</span> Generated <span class="token keyword">tables</span> filled <span class="token keyword">with</span> sequential <span class="token keyword">values</span>                                                  <span class="token operator">|</span> YES          <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> YES        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">InnoDB</span>             <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> <span class="token operator">|</span> Supports <span class="token keyword">transactions</span><span class="token punctuation">,</span> <span class="token keyword">row</span><span class="token operator">-</span><span class="token keyword">level</span> locking<span class="token punctuation">,</span> <span class="token keyword">foreign</span> <span class="token keyword">keys</span> <span class="token operator">and</span> encryption <span class="token keyword">for</span> <span class="token keyword">tables</span>                <span class="token operator">|</span> YES          <span class="token operator">|</span> YES  <span class="token operator">|</span> YES        <span class="token operator">|</span>
<span class="token operator">|</span> PERFORMANCE_SCHEMA <span class="token operator">|</span> YES     <span class="token operator">|</span> Performance <span class="token keyword">Schema</span>                                                                              <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p><strong>示例演示:</strong></p> <p>A.  查询建表语句 --- 默认存储引擎: InnoDB</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>test<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> account<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842814.png" alt="image-20220630235552760"></p> <p>我们可以看到，创建表时，即使我们没有指定存储疫情，数据库也会自动选择默认的存储引擎。</p> <p>B.  查询当前数据库支持的存储引擎</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>test<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> engines<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token operator">|</span> <span class="token keyword">Engine</span>             <span class="token operator">|</span> Support <span class="token operator">|</span> <span class="token keyword">Comment</span>                                                                                         <span class="token operator">|</span> <span class="token keyword">Transactions</span> <span class="token operator">|</span> XA   <span class="token operator">|</span> Savepoints <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token operator">|</span> CSV                <span class="token operator">|</span> YES     <span class="token operator">|</span> Stores <span class="token keyword">tables</span> <span class="token keyword">as</span> CSV files                                                                      <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MRG_MyISAM         <span class="token operator">|</span> YES     <span class="token operator">|</span> Collection <span class="token keyword">of</span> identical MyISAM <span class="token keyword">tables</span>                                                           <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MEMORY             <span class="token operator">|</span> YES     <span class="token operator">|</span> <span class="token keyword">Hash</span> based<span class="token punctuation">,</span> stored <span class="token operator">in</span> memory<span class="token punctuation">,</span> useful <span class="token keyword">for</span> <span class="token keyword">temporary</span> <span class="token keyword">tables</span>                                       <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> Aria               <span class="token operator">|</span> YES     <span class="token operator">|</span> Crash<span class="token operator">-</span>safe <span class="token keyword">tables</span> <span class="token keyword">with</span> MyISAM heritage<span class="token punctuation">.</span> Used <span class="token keyword">for</span> internal <span class="token keyword">temporary</span> <span class="token keyword">tables</span> <span class="token operator">and</span> privilege <span class="token keyword">tables</span> <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> MyISAM             <span class="token operator">|</span> YES     <span class="token operator">|</span> Non<span class="token operator">-</span>transactional <span class="token keyword">engine</span> <span class="token keyword">with</span> good performance <span class="token operator">and</span> small <span class="token keyword">data</span> footprint                         <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">|</span> SEQUENCE           <span class="token operator">|</span> YES     <span class="token operator">|</span> Generated <span class="token keyword">tables</span> filled <span class="token keyword">with</span> sequential <span class="token keyword">values</span>                                                  <span class="token operator">|</span> YES          <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> YES        <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">InnoDB</span>             <span class="token operator">|</span> <span class="token keyword">DEFAULT</span> <span class="token operator">|</span> Supports <span class="token keyword">transactions</span><span class="token punctuation">,</span> <span class="token keyword">row</span><span class="token operator">-</span><span class="token keyword">level</span> locking<span class="token punctuation">,</span> <span class="token keyword">foreign</span> <span class="token keyword">keys</span> <span class="token operator">and</span> encryption <span class="token keyword">for</span> <span class="token keyword">tables</span>                <span class="token operator">|</span> YES          <span class="token operator">|</span> YES  <span class="token operator">|</span> YES        <span class="token operator">|</span>
<span class="token operator">|</span> PERFORMANCE_SCHEMA <span class="token operator">|</span> YES     <span class="token operator">|</span> Performance <span class="token keyword">Schema</span>                                                                              <span class="token operator">|</span> <span class="token keyword">NO</span>           <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>         <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------+---------+-------------------------------------------------------------------------------------------------+--------------+------+------------+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>C.  创建表 my_myisam , 并指定MyISAM存储引擎</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>test<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> my_myisam<span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> id <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span> MyISAM<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.002</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>D.  创建表 my_memory , 指定Memory存储引擎</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>test<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> my_memory<span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> id <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span> <span class="token keyword">engine</span> <span class="token operator">=</span> Memory<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.002</span> sec<span class="token punctuation">)</span>
</code></pre></div><h3 id="_1-3-存储引擎特点"><a href="#_1-3-存储引擎特点" class="header-anchor">#</a> 1.3 存储引擎特点</h3> <p>上面我们介绍了什么是存储引擎，以及如何在建表时如何指定存储引擎，接下来我们就来介绍下来上面重点提到的三种存储引擎 InnoDB、MyISAM、Memory的特点。</p> <h4 id="_1-3-1-innodb"><a href="#_1-3-1-innodb" class="header-anchor">#</a> 1.3.1 InnoDB</h4> <p><strong>1). 介绍</strong></p> <p>InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在 MySQL 5.5 之后，InnoDB是默认的MySQL 存储引擎。</p> <p><strong>2). 特点</strong></p> <ul><li><p>DML操作遵循ACID模型，支持事务；</p></li> <li><p>行级锁，提高并发访问性能；</p></li> <li><p>支持外键FOREIGN KEY约束，保证数据的完整性和正确性；</p></li></ul> <p><strong>3). 文件</strong></p> <p>xxx.ibd：xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构（frm-早期的 、sdi-新版的）、数据和索引。</p> <p>参数：<code>innodb_file_per_table</code></p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>test<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_file_per_table'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
<span class="token operator">|</span> Variable_name         <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
<span class="token operator">|</span> innodb_file_per_table <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>如果该参数开启，代表对于InnoDB引擎的表，每一张表都对应一个ibd文件。 我们直接打开MySQL的</p> <p>数据存放目录： C:\ProgramData\MySQL\MySQL Server 8.0\Data ， 这个目录下有很多文件夹，不同的文件夹代表不同的数据库，我们直接打开itcast文件夹。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842335.png" alt="image-20220701000059318"></p> <p>可以看到里面有很多的ibd文件，每一个ibd文件就对应一张表，比如：我们有一张表 account，就有这样的一个account.ibd文件，而在这个ibd文件中不仅存放表结构、数据，还会存放该表对应的索引信息。 而该文件是基于二进制存储的，不能直接基于记事本打开，我们可以使用mysql提供的一个指令 ibd2sdi ，通过该指令就可以从ibd文件中提取sdi信息，而sdi数据字典信息中就包含该表的表结构。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842101.png" alt="image-20220701000108459"></p> <p>逻辑存储结构</p> <ul><li><code>段</code> : 表空间是由各个段组成的， 常见的段有数据段、索引段、回滚段等。InnoDB中对于段的管理，都是引擎自身完成，不需要人为对其控制，一个段中包含多个区。</li> <li><code>区</code> : 区是表空间的单元结构，每个区的大小为<code>1M</code>。 默认情况下， InnoDB存储引擎页大小为<code>16K</code>， 即一个区中一共有64个连续的页。</li> <li><code>页</code> : 页是组成区的最小单元，<code>页也是InnoDB 存储引擎磁盘管理的最小单元</code>，每个页的大小默认为 <code>16KB</code>。为了保证页的连续性，InnoDB 存储引擎每次从磁盘申请 <code>4-5 个区</code>。</li> <li><code>行</code> : InnoDB 存储引擎是面向行的，也就是说数据是按行进行存放的，在每一行中除了定义表时所指定的字段以外，还包含两个隐藏字段(后面会详细介绍)。</li></ul> <h4 id="_1-3-2-myisam"><a href="#_1-3-2-myisam" class="header-anchor">#</a> 1.3.2 MyISAM</h4> <p>1). 介绍</p> <p>MyISAM是MySQL早期的默认存储引擎。</p> <p>2). 特点</p> <p>不支持事务，不支持外键支持表锁，不支持行锁</p> <p>访问速度快</p> <p>3). 文件</p> <ul><li><p>xxx.sdi：存储表结构信息</p></li> <li><p>xxx.MYD: 存储数据</p></li> <li><p>xxx.MYI: 存储索引</p></li></ul> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842277.png" alt="image-20220701000347001"></p> <h4 id="_1-3-3-memory"><a href="#_1-3-3-memory" class="header-anchor">#</a> 1.3.3 Memory</h4> <p>1). 介绍</p> <ul><li>Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。</li></ul> <p>2). 特点 内存存放</p> <ul><li><code>hash索引（默认）</code></li></ul> <p>3).文件</p> <ul><li>xxx.sdi：存储表结构信息</li></ul> <h4 id="_1-3-4-区别及特点"><a href="#_1-3-4-区别及特点" class="header-anchor">#</a> 1.3.4 区别及特点</h4> <table><thead><tr><th><strong>特点</strong></th> <th><strong>InnoDB</strong></th> <th><strong>MyISAM</strong></th> <th><strong>Memory</strong></th></tr></thead> <tbody><tr><td>存储限制</td> <td>64TB</td> <td>有</td> <td>有</td></tr> <tr><td>事务安全</td> <td>支持</td> <td>-</td> <td>-</td></tr> <tr><td>锁机制</td> <td>行锁</td> <td>表锁</td> <td>表锁</td></tr> <tr><td>B+tree索引</td> <td>支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>Hash索引</td> <td>-</td> <td>-</td> <td>支持</td></tr> <tr><td>全文索引</td> <td>支持(5.6版本之后)</td> <td>支持</td> <td>-</td></tr> <tr><td>空间使用</td> <td>高</td> <td>低</td> <td>N/A</td></tr> <tr><td>内存使用</td> <td>高</td> <td>低</td> <td>中等</td></tr> <tr><td>批量插入速度</td> <td>低</td> <td>高</td> <td>高</td></tr> <tr><td>支持外键</td> <td>支持</td> <td>-</td> <td>-</td></tr></tbody></table> <p><strong>面试题:</strong></p> <p>InnoDB引擎与MyISAM引擎的区别 ?</p> <ol><li><p>InnoDB引擎, 支持事务, 而MyISAM不支持。</p></li> <li><p>InnoDB引擎, 支持行锁和表锁, 而MyISAM仅支持表锁, 不支持行锁。</p></li> <li><p>InnoDB引擎, 支持外键, 而MyISAM是不支持的。</p></li></ol> <blockquote><p>主要是上述三点区别，当然也可以从索引结构、存储限制等方面，更加深入的回答，具体参考如下官方文档：</p> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html" target="_blank" rel="noopener noreferrer"><strong>https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html" target="_blank" rel="noopener noreferrer"><strong>https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_1-4-存储引擎选择"><a href="#_1-4-存储引擎选择" class="header-anchor">#</a> 1.4 存储引擎选择</h3> <p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统，还可以根据实际情况选择多种存储引擎进行组合。</p> <ul><li><code>InnoDB:</code> 是Mysql的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。</li> <li><code>MyISAM：</code> 如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。</li> <li><code>MEMORY：</code>将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保障数据的安全性。</li></ul> <h2 id="_2-索引"><a href="#_2-索引" class="header-anchor">#</a> 2. 索引</h2> <h3 id="_2-1-索引概述"><a href="#_2-1-索引概述" class="header-anchor">#</a> 2.1 索引概述</h3> <h4 id="_2-1-1-介绍"><a href="#_2-1-1-介绍" class="header-anchor">#</a> 2.1.1 介绍</h4> <p><code>索引（index）是帮助MySQL高效获取数据的数据结构(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据， 这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。</code></p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842597.png" alt="image-20220701000555007"></p> <p>一提到数据结构，大家都会有所担心，担心自己不能理解，跟不上节奏。不过在这里大家完全不用担心，我们后面在讲解时，会详细介绍。</p> <p><strong>2.2 演示</strong></p> <p>表结构及其数据如下：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842454.png" alt="image-20220701000628921"></p> <p>假如我们要执行的SQL语句为 ： select * from user where age = 45;</p> <p>1). 无索引情况</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010843949.png" alt="image-20220701000637592"></p> <p>在无索引情况下，就需要从第一行开始扫描，一直扫描到最后一行，我们称之为 全表扫描，性能很低。</p> <p>2). 有索引情况如果我们针对于这张表建立了索引，假设索引结构就是二叉树，那么也就意味着，会对age这个字段建立一个二叉树的索引结构。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010842630.png" alt="image-20220701000646127"></p> <p>此时我们在进行查询时，只需要扫描三次就可以找到数据了，极大的提高的查询的效率。</p> <blockquote><p>备注： 这里我们只是假设索引的结构是二叉树，介绍一下索引的大概原理，只是一个示意图，并不是索引的真实结构，索引的真实结构，后面会详细介绍。</p></blockquote> <h4 id="_2-3-特点"><a href="#_2-3-特点" class="header-anchor">#</a> 2.3 特点</h4> <table><thead><tr><th><strong>优势</strong></th> <th><strong>劣势</strong></th></tr></thead> <tbody><tr><td>提高数据检索的效率，降低数据库的IO成本</td> <td>索引列也是要占用空间的。</td></tr> <tr><td>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。</td> <td>索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。</td></tr></tbody></table> <h3 id="_2-2-索引结构"><a href="#_2-2-索引结构" class="header-anchor">#</a> 2.2 索引结构</h3> <h4 id="_2-2-1-概述"><a href="#_2-2-1-概述" class="header-anchor">#</a> 2.2.1 概述</h4> <p>MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构，主要包含以下几种：</p> <table><thead><tr><th><strong>索引结构</strong></th> <th><strong>描述</strong></th></tr></thead> <tbody><tr><td>B+Tree索引</td> <td>最常见的索引类型，大部分引擎都支持  B+ 树索引</td></tr> <tr><td>Hash索引</td> <td>底层数据结构是用哈希表实现的,  只有精确匹配索引列的查询才有效, 不支持范围查询</td></tr> <tr><td>R-tree(空间索  引）</td> <td>空间索引是MyISAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td></tr> <tr><td>Full-text(全文索引)</td> <td>是一种通过建立倒排索引,快速匹配文档的方式。类似于  Lucene,Solr,ES</td></tr></tbody></table> <p>上述是MySQL中所支持的所有的索引结构，接下来，我们再来看看不同的存储引擎对于索引结构的支持情况。</p> <table><thead><tr><th><strong>索引</strong></th> <th><strong>InnoDB</strong></th> <th><strong>MyISAM</strong></th> <th><strong>Memory</strong></th></tr></thead> <tbody><tr><td>B+tree索引</td> <td>支持</td> <td>支持</td> <td>支持</td></tr> <tr><td>Hash 索引</td> <td>不支持</td> <td>不支持</td> <td>支持</td></tr> <tr><td>R-tree  索引</td> <td>不支持</td> <td>支持</td> <td>不支持</td></tr> <tr><td>Full-text</td> <td>5.6版本之后支持</td> <td>支持</td> <td>不支持</td></tr></tbody></table> <blockquote><p>注意： 我们平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引。</p></blockquote> <h4 id="_2-2-2-二叉树"><a href="#_2-2-2-二叉树" class="header-anchor">#</a> 2.2.2 二叉树</h4> <p>假如说MySQL的索引结构采用二叉树的数据结构，比较理想的结构如下：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010843317.png" alt="image-20220701000735678"></p> <p>如果主键是顺序插入的，则会形成一个单向链表，结构如下：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010843366.png" alt="image-20220701000744479"></p> <p>所以，如果选择二叉树作为索引结构，会存在以下缺点：</p> <ul><li><p>顺序插入时，会形成一个链表，查询性能大大降低。</p></li> <li><p>大数据量情况下，层级较深，检索速度慢。</p></li></ul> <p>此时大家可能会想到，我们可以选择红黑树，红黑树是一颗自平衡二叉树，那这样即使是顺序插入数据，最终形成的数据结构也是一颗平衡的二叉树,结构如下:</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844045.png" alt="image-20220701000756648"></p> <p>但是，即使如此，由于红黑树也是一颗二叉树，所以也会存在一个缺点：</p> <ul><li>大数据量情况下，层级较深，检索速度慢。</li></ul> <p><code>所以，在MySQL的索引结构中，并没有选择二叉树或者红黑树，而选择的是B+Tree，那么什么是B+Tree呢？在详解B+Tree之前，先来介绍一个B-Tree。</code></p> <h4 id="_2-2-3-b-tree"><a href="#_2-2-3-b-tree" class="header-anchor">#</a> 2.2.3 B-Tree</h4> <p><code>B-Tree，B树是一种多叉路衡查找树，相对于二叉树，B树每个节点可以有多个分支，即多叉。</code></p> <p>以一颗最大度数（max-degree）为5(5阶)的b-tree为例，那这个B树每个节点最多存储4个key，5 个指针：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844492.png" alt="image-20220701000823762"></p> <blockquote><p>知识小贴士: 树的度数指的是一个节点的子节点个数。</p></blockquote> <p><a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noopener noreferrer">我们可以通过一个数据结构可视化的网站来简单演示一下。 <strong>https://www.cs.usfca.edu/~gall es/visualization/BTree.html</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844727.png" alt="image-20220701000847938"></p> <p>插入一组数据： 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 。然后观察一些数据插入过程中，节点的变化情况。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844355.png" alt="image-20220701000854888"></p> <p>特点：</p> <ul><li><p>5阶的B树，每一个节点最多存储4个key，对应5个指针。</p></li> <li><p>一旦节点存储的key数量到达5，就会裂变，中间元素向上分裂。</p></li> <li><p>在B树中，非叶子节点和叶子节点都会存放数据。</p></li></ul> <h4 id="_2-2-4-b-tree"><a href="#_2-2-4-b-tree" class="header-anchor">#</a> 2.2.4 B+Tree</h4> <p>B+Tree是B-Tree的变种，我们以一颗最大度数（max-degree）为4（4阶）的b+tree为例，来看一下其结构示意图：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844655.png" alt="image-20220701000919975"></p> <p>我们可以看到，两部分：</p> <ul><li>绿色框框起来的部分，是索引部分，仅仅起到索引数据的作用，不存储数据。红色框框起来的部分，是数据存储部分，在其叶子节点中要存储具体的数据。</li></ul> <p><a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html" target="_blank" rel="noopener noreferrer">我们可以通过一个数据结构可视化的网站来简单演示一下。 <strong>https://www.cs.usfca.edu/~gall es/visualization/BPlusTree.html</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844382.png" alt="image-20220701000945233"></p> <p>插入一组数据： 100 65 169 368 900 556 780 35 215 1200 234 888 158 90 1000 88 120 268 250 。然后观察一些数据插入过程中，节点的变化情况。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844517.png" alt="image-20220701000956261"></p> <p>最终我们看到，B+Tree 与 B-Tree相比，主要有以下三点区别：</p> <ul><li><p>所有的数据都会出现在叶子节点。</p></li> <li><p>叶子节点形成一个单向链表。</p></li> <li><p>非叶子节点仅仅起到索引数据作用，具体的数据都是在叶子节点存放的。</p></li></ul> <p>上述我们所看到的结构是标准的B+Tree的数据结构，接下来，我们再来看看MySQL中优化之后的B+Tree。</p> <p>MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能，利于排序。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844573.png" alt="image-20220701001057205"></p> <h4 id="_2-2-5-hash"><a href="#_2-2-5-hash" class="header-anchor">#</a> 2.2.5 Hash</h4> <p>MySQL中除了支持B+Tree索引，还支持一种索引类型---Hash索引。</p> <p><strong>1).结构</strong></p> <p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在 hash表中。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844417.png" alt="image-20220701001122051"></p> <p>如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞），可以通过链表来解决。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844021.png" alt="image-20220701001127852"></p> <p><strong>2). 特点</strong></p> <p>A.  Hash索引只能用于对等比较(=，in)，不支持范围查询（between，&gt;，&lt; ，...）</p> <p>B.  无法利用索引完成排序操作</p> <p>C.  查询效率高，通常(不存在hash冲突的情况)只需要一次检索就可以了，效率通常要高于B+tree索引</p> <p><strong>3). 存储引擎支持</strong></p> <p>在MySQL中，支持hash索引的是Memory存储引擎。 而InnoDB中具有自适应hash功能，hash索引是</p> <p>InnoDB存储引擎根据B+Tree索引在指定条件下自动构建的。</p> <blockquote><p>思考题： 为什么InnoDB存储引擎选择使用B+tree索引结构?</p></blockquote> <ul><li><p>A.  相对于二叉树，层级更少，搜索效率高；</p></li> <li><p>B.  对于B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低；</p></li> <li><p>C.  相对Hash索引，B+tree支持范围匹配及排序操作；</p></li></ul> <h3 id="_2-3-索引分类"><a href="#_2-3-索引分类" class="header-anchor">#</a> 2.3 索引分类</h3> <h4 id="_2-3-1-索引分类"><a href="#_2-3-1-索引分类" class="header-anchor">#</a> 2.3.1 索引分类</h4> <p>在MySQL数据库，将索引的具体类型主要分为以下几类：主键索引、唯一索引、常规索引、全文索引。</p> <table><thead><tr><th><strong>分类</strong></th> <th><strong>含义</strong></th> <th><strong>特点</strong></th> <th><strong>关键字</strong></th></tr></thead> <tbody><tr><td>主键索引</td> <td>针对于表中主键创建的索引</td> <td>默认自动创建,  只能有一个</td> <td>PRIMARY</td></tr> <tr><td>唯一索引</td> <td>避免同一个表中某数据列中的值重复</td> <td>可以有多个</td> <td>UNIQUE</td></tr> <tr><td>常规索引</td> <td>快速定位特定数据</td> <td>可以有多个</td> <td></td></tr> <tr><td>全文索引</td> <td>全文索引查找的是文本中的关键词，而不是比较索引中的值</td> <td>可以有多个</td> <td>FULLTEXT</td></tr></tbody></table> <h4 id="_2-3-2-聚集索引-二级索引"><a href="#_2-3-2-聚集索引-二级索引" class="header-anchor">#</a> 2.3.2 聚集索引&amp;二级索引</h4> <p>而在在InnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种：</p> <table><thead><tr><th><strong>分类</strong></th> <th><strong>含义</strong></th> <th><strong>特点</strong></th></tr></thead> <tbody><tr><td>聚集索引(Clustered  Index)</td> <td>将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据</td> <td>必须有,而且只有一个</td></tr> <tr><td>二级索引(Secondary  Index)</td> <td>将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td> <td>可以存在多个</td></tr></tbody></table> <p>聚集索引选取规则:</p> <ul><li><p>如果存在主键，主键索引就是聚集索引。如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。</p></li> <li><p>如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。</p></li></ul> <p>聚集索引和二级索引的具体结构如下：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844733.png" alt="image-20220701001300420"></p> <ul><li>聚集索引的叶子节点下挂的是这一行的数据</li> <li>二级索引的叶子节点下挂的是该字段值对应的主键值。</li></ul> <p>接下来，我们来分析一下，当我们执行如下的SQL语句时，具体的查找过程是什么样子的。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844366.png" alt="image-20220701001338804"></p> <p>具体过程如下:</p> <ol><li><p>由于是根据name字段进行查询，所以先根据name='Arm'到name字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。</p></li> <li><p>由于查询返回的数据是*，所以此时，还需要根据主键值10，到聚集索引中查找10对应的记录，最终找到10对应的行row。</p></li> <li><p>最终拿到这一行的数据，直接返回即可。</p></li></ol> <blockquote><p>回表查询： 这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取数据的方式，就称之为回表查询。</p> <p>思考题：以下两条SQL语句，那个执行效率高? 为什么?</p></blockquote> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span> <span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'Arm'</span> <span class="token punctuation">;</span>

备注: id为主键，name字段创建的有索引；
</code></pre></div><p>解答：</p> <p>A 语句的执行性能要高于B 语句。因为A语句直接走聚集索引，直接返回数据。 而B语句需要先查询name字段的二级索引，然后再查询聚集索引，也就是需要进行回表查询。</p> <blockquote><p>思考题：InnoDB主键索引的B+tree高度为多高呢?</p></blockquote> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844590.png" alt="image-20220701001517117"></p> <div class="language-shell extra-class"><pre class="language-shell"><code>假设: 一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB的指针占用6个字节的空间，主键即使为bigint，占用字节数为8。高度为2：
n * <span class="token number">8</span> + <span class="token punctuation">(</span>n + <span class="token number">1</span><span class="token punctuation">)</span> * <span class="token number">6</span> <span class="token operator">=</span> <span class="token number">16</span>*1024 , 算出n约为 <span class="token number">1170</span>
<span class="token number">1171</span>* <span class="token number">16</span> <span class="token operator">=</span> <span class="token number">18736</span>

也就是说，如果树的高度为2，则可以存储 <span class="token number">18000</span> 多条记录。高度为3：
<span class="token number">1171</span> * <span class="token number">1171</span> * <span class="token number">16</span> <span class="token operator">=</span> <span class="token number">21939856</span>

也就是说，如果树的高度为3，则可以存储 2200w 左右的记录。
</code></pre></div><h3 id="_2-4-索引语法"><a href="#_2-4-索引语法" class="header-anchor">#</a> 2.4 索引语法</h3> <p><strong>1). 创建索引</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">UNIQUE</span> <span class="token operator">|</span> FULLTEXT<span class="token punctuation">]</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name<span class="token punctuation">(</span>index_col_name<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>2). 查看索引</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> table_name<span class="token punctuation">;</span>
</code></pre></div><p><strong>3). 删除索引</strong></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> index_name <span class="token keyword">ON</span> table_name<span class="token punctuation">;</span>
</code></pre></div><p><strong>案例演示:</strong></p> <p>先来创建一张表 tb_user，并且查询测试数据。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">table</span> tb_user<span class="token punctuation">(</span>
	id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span> <span class="token keyword">comment</span> <span class="token string">'主键'</span><span class="token punctuation">,</span>
	name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
	phone <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
	email <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
	profession <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'专业'</span><span class="token punctuation">,</span>
	age <span class="token keyword">tinyint</span> <span class="token keyword">unsigned</span> <span class="token keyword">comment</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
	gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'性别 , 1: 男, 2: 女'</span><span class="token punctuation">,</span>
	<span class="token keyword">status</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'状态'</span><span class="token punctuation">,</span>
	createtime <span class="token keyword">datetime</span> <span class="token keyword">comment</span> <span class="token string">'创建时间'</span>
<span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'系统用户表'</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'吕布'</span><span class="token punctuation">,</span> <span class="token string">'17799990000'</span><span class="token punctuation">,</span> <span class="token string">'lvbu666@163.com'</span><span class="token punctuation">,</span> <span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token string">'2001-02-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'曹操'</span><span class="token punctuation">,</span> <span class="token string">'17799990001'</span><span class="token punctuation">,</span> <span class="token string">'caocao666@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'通讯工程'</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-03-05 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'赵云'</span><span class="token punctuation">,</span> <span class="token string">'17799990002'</span><span class="token punctuation">,</span> <span class="token string">'17799990@139.com'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'2002-03-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'孙悟空'</span><span class="token punctuation">,</span> <span class="token string">'17799990003'</span><span class="token punctuation">,</span> <span class="token string">'17799990@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'工程造价'</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-07-02 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'花木兰'</span><span class="token punctuation">,</span> <span class="token string">'17799990004'</span><span class="token punctuation">,</span> <span class="token string">'19980729@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2001-04-22 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'大乔'</span><span class="token punctuation">,</span> <span class="token string">'17799990005'</span><span class="token punctuation">,</span> <span class="token string">'daqiao666@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'舞蹈'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-02-07 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'露娜'</span><span class="token punctuation">,</span> <span class="token string">'17799990006'</span><span class="token punctuation">,</span> <span class="token string">'luna_love@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'应用数学'</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-02-08 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'程咬金'</span><span class="token punctuation">,</span> <span class="token string">'17799990007'</span><span class="token punctuation">,</span> <span class="token string">'chengyaojin@163.com'</span><span class="token punctuation">,</span> <span class="token string">'化工'</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'2001-05-23 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'项羽'</span><span class="token punctuation">,</span> <span class="token string">'17799990008'</span><span class="token punctuation">,</span> <span class="token string">'xiaoyu666@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'金属材料'</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-09-18 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'白起'</span><span class="token punctuation">,</span> <span class="token string">'17799990009'</span><span class="token punctuation">,</span> <span class="token string">'baiqi666@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'机械工程及其自动化'</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'2001-08-16 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'韩信'</span><span class="token punctuation">,</span> <span class="token string">'17799990010'</span><span class="token punctuation">,</span> <span class="token string">'hanxin520@163.com'</span><span class="token punctuation">,</span> <span class="token string">'无机非金属材料工程'</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-06-12 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'荆轲'</span><span class="token punctuation">,</span> <span class="token string">'17799990011'</span><span class="token punctuation">,</span> <span class="token string">'jingke123@163.com'</span><span class="token punctuation">,</span> <span class="token string">'会计'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-05-11 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'兰陵王'</span><span class="token punctuation">,</span> <span class="token string">'17799990012'</span><span class="token punctuation">,</span> <span class="token string">'lanlinwang666@126.com'</span><span class="token punctuation">,</span> <span class="token string">'工程造价'</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2001-04-09 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'狂铁'</span><span class="token punctuation">,</span> <span class="token string">'17799990013'</span><span class="token punctuation">,</span> <span class="token string">'kuangtie@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'应用数学'</span><span class="token punctuation">,</span> <span class="token number">43</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'2001-04-10 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'貂蝉'</span><span class="token punctuation">,</span> <span class="token string">'17799990014'</span><span class="token punctuation">,</span> <span class="token string">'84958948374@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'2001-02-12 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'妲己'</span><span class="token punctuation">,</span> <span class="token string">'17799990015'</span><span class="token punctuation">,</span> <span class="token string">'2783238293@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'软件工程'</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-01-30 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'芈月'</span><span class="token punctuation">,</span> <span class="token string">'17799990016'</span><span class="token punctuation">,</span> <span class="token string">'xiaomin2001@sina.com'</span><span class="token punctuation">,</span> <span class="token string">'工业经济'</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2000-05-03 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'嬴政'</span><span class="token punctuation">,</span> <span class="token string">'17799990017'</span><span class="token punctuation">,</span> <span class="token string">'8839434342@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'化工'</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2001-08-08 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'狄仁杰'</span><span class="token punctuation">,</span> <span class="token string">'17799990018'</span><span class="token punctuation">,</span> <span class="token string">'jujiamlm8166@163.com'</span><span class="token punctuation">,</span> <span class="token string">'国际贸易'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2007-03-12 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'安琪拉'</span><span class="token punctuation">,</span> <span class="token string">'17799990019'</span><span class="token punctuation">,</span> <span class="token string">'jdodm1h@126.com'</span><span class="token punctuation">,</span> <span class="token string">'城市规划'</span><span class="token punctuation">,</span> <span class="token number">51</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2001-08-15 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'典韦'</span><span class="token punctuation">,</span> <span class="token string">'17799990020'</span><span class="token punctuation">,</span> <span class="token string">'ycaunanjian@163.com'</span><span class="token punctuation">,</span> <span class="token string">'城市规划'</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'2000-04-12 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'廉颇'</span><span class="token punctuation">,</span> <span class="token string">'17799990021'</span><span class="token punctuation">,</span> <span class="token string">'lianpo321@126.com'</span><span class="token punctuation">,</span> <span class="token string">'土木工程'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'2002-07-18 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'后羿'</span><span class="token punctuation">,</span> <span class="token string">'17799990022'</span><span class="token punctuation">,</span> <span class="token string">'altycj2000@139.com'</span><span class="token punctuation">,</span> <span class="token string">'城市园林'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'2002-03-10 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tb_user <span class="token punctuation">(</span>name<span class="token punctuation">,</span> phone<span class="token punctuation">,</span> email<span class="token punctuation">,</span> profession<span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span>createtime<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'姜子牙'</span><span class="token punctuation">,</span> <span class="token string">'17799990023'</span><span class="token punctuation">,</span> <span class="token string">'37483844@qq.com'</span><span class="token punctuation">,</span> <span class="token string">'工程造价'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'2003-05-26 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>表结构中插入的数据如下：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> phone       <span class="token operator">|</span> email                 <span class="token operator">|</span> profession                  <span class="token operator">|</span> age  <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token keyword">status</span> <span class="token operator">|</span> createtime          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 吕布      <span class="token operator">|</span> <span class="token number">17799990000</span> <span class="token operator">|</span> lvbu666<span class="token variable">@163.com</span>       <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">6</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 曹操      <span class="token operator">|</span> <span class="token number">17799990001</span> <span class="token operator">|</span> caocao666<span class="token variable">@qq.com</span>      <span class="token operator">|</span> 通讯工程                    <span class="token operator">|</span>   <span class="token number">33</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 赵云      <span class="token operator">|</span> <span class="token number">17799990002</span> <span class="token operator">|</span> <span class="token number">17799990</span><span class="token variable">@139.com</span>      <span class="token operator">|</span> 英语                        <span class="token operator">|</span>   <span class="token number">34</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 孙悟空    <span class="token operator">|</span> <span class="token number">17799990003</span> <span class="token operator">|</span> <span class="token number">17799990</span><span class="token variable">@sina.com</span>     <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">54</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 花木兰    <span class="token operator">|</span> <span class="token number">17799990004</span> <span class="token operator">|</span> <span class="token number">19980729</span><span class="token variable">@sina.com</span>     <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">23</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 大乔      <span class="token operator">|</span> <span class="token number">17799990005</span> <span class="token operator">|</span> daqiao666<span class="token variable">@sina.com</span>    <span class="token operator">|</span> 舞蹈                        <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 露娜      <span class="token operator">|</span> <span class="token number">17799990006</span> <span class="token operator">|</span> luna_love<span class="token variable">@sina.com</span>    <span class="token operator">|</span> 应用数学                    <span class="token operator">|</span>   <span class="token number">24</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">08</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 程咬金    <span class="token operator">|</span> <span class="token number">17799990007</span> <span class="token operator">|</span> chengyaojin<span class="token variable">@163.com</span>   <span class="token operator">|</span> 化工                        <span class="token operator">|</span>   <span class="token number">38</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">5</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 项羽      <span class="token operator">|</span> <span class="token number">17799990008</span> <span class="token operator">|</span> xiaoyu666<span class="token variable">@qq.com</span>      <span class="token operator">|</span> 金属材料                    <span class="token operator">|</span>   <span class="token number">43</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 白起      <span class="token operator">|</span> <span class="token number">17799990009</span> <span class="token operator">|</span> baiqi666<span class="token variable">@sina.com</span>     <span class="token operator">|</span> 机械工程及其自动化          <span class="token operator">|</span>   <span class="token number">27</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 韩信      <span class="token operator">|</span> <span class="token number">17799990010</span> <span class="token operator">|</span> hanxin520<span class="token variable">@163.com</span>     <span class="token operator">|</span> 无机非金属材料工程          <span class="token operator">|</span>   <span class="token number">27</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 荆轲      <span class="token operator">|</span> <span class="token number">17799990011</span> <span class="token operator">|</span> jingke123<span class="token variable">@163.com</span>     <span class="token operator">|</span> 会计                        <span class="token operator">|</span>   <span class="token number">29</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">13</span> <span class="token operator">|</span> 兰陵王    <span class="token operator">|</span> <span class="token number">17799990012</span> <span class="token operator">|</span> lanlinwang666<span class="token variable">@126.com</span> <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">44</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">14</span> <span class="token operator">|</span> 狂铁      <span class="token operator">|</span> <span class="token number">17799990013</span> <span class="token operator">|</span> kuangtie<span class="token variable">@sina.com</span>     <span class="token operator">|</span> 应用数学                    <span class="token operator">|</span>   <span class="token number">43</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">15</span> <span class="token operator">|</span> 貂蝉      <span class="token operator">|</span> <span class="token number">17799990014</span> <span class="token operator">|</span> <span class="token number">84958948374</span><span class="token variable">@qq.com</span>    <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">16</span> <span class="token operator">|</span> 妲己      <span class="token operator">|</span> <span class="token number">17799990015</span> <span class="token operator">|</span> <span class="token number">2783238293</span><span class="token variable">@qq.com</span>     <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">31</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">17</span> <span class="token operator">|</span> 芈月      <span class="token operator">|</span> <span class="token number">17799990016</span> <span class="token operator">|</span> xiaomin2001<span class="token variable">@sina.com</span>  <span class="token operator">|</span> 工业经济                    <span class="token operator">|</span>   <span class="token number">35</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2000</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">18</span> <span class="token operator">|</span> 嬴政      <span class="token operator">|</span> <span class="token number">17799990017</span> <span class="token operator">|</span> <span class="token number">8839434342</span><span class="token variable">@qq.com</span>     <span class="token operator">|</span> 化工                        <span class="token operator">|</span>   <span class="token number">38</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">08</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">19</span> <span class="token operator">|</span> 狄仁杰    <span class="token operator">|</span> <span class="token number">17799990018</span> <span class="token operator">|</span> jujiamlm8166<span class="token variable">@163.com</span>  <span class="token operator">|</span> 国际贸易                    <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">20</span> <span class="token operator">|</span> 安琪拉    <span class="token operator">|</span> <span class="token number">17799990019</span> <span class="token operator">|</span> jdodm1h<span class="token variable">@126.com</span>       <span class="token operator">|</span> 城市规划                    <span class="token operator">|</span>   <span class="token number">51</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">21</span> <span class="token operator">|</span> 典韦      <span class="token operator">|</span> <span class="token number">17799990020</span> <span class="token operator">|</span> ycaunanjian<span class="token variable">@163.com</span>   <span class="token operator">|</span> 城市规划                    <span class="token operator">|</span>   <span class="token number">52</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2000</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span> <span class="token operator">|</span> 廉颇      <span class="token operator">|</span> <span class="token number">17799990021</span> <span class="token operator">|</span> lianpo321<span class="token variable">@126.com</span>     <span class="token operator">|</span> 土木工程                    <span class="token operator">|</span>   <span class="token number">19</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">23</span> <span class="token operator">|</span> 后羿      <span class="token operator">|</span> <span class="token number">17799990022</span> <span class="token operator">|</span> altycj2000<span class="token variable">@139.com</span>    <span class="token operator">|</span> 城市园林                    <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">24</span> <span class="token operator">|</span> 姜子牙    <span class="token operator">|</span> <span class="token number">17799990023</span> <span class="token operator">|</span> <span class="token number">37483844</span><span class="token variable">@qq.com</span>       <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">29</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">4</span>      <span class="token operator">|</span> <span class="token number">2003</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token number">24</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
<span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>media<span class="token operator">/</span>image36<span class="token punctuation">.</span>jpg<span class="token punctuation">)</span>{width<span class="token operator">=</span><span class="token string">&quot;6.138267716535433in&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;3.1889818460192476in&quot;</span>}
</code></pre></div><p>数据准备好了之后，接下来，我们就来完成如下需求：</p> <p>A.  name字段为姓名字段，该字段的值可能会重复，为该字段创建索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_name <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre></div><p>B.  phone手机号字段的值，是非空，且唯一的，为该字段创建唯一索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_phone <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre></div><p>C.  为profession、age、status创建联合索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_pro_age_sta <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>profession<span class="token punctuation">,</span>age<span class="token punctuation">,</span><span class="token keyword">status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre></div><p>D.  为email建立合适的索引来提升查询效率。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_email <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre></div><p>完成上述的需求之后，我们再查看tb_user表的所有的索引数据。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone_name  <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone_name  <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_use_profession   <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email_5          <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-5-sql性能分析"><a href="#_2-5-sql性能分析" class="header-anchor">#</a> 2.5 SQL性能分析</h3> <h4 id="_2-5-1-sql执行频率"><a href="#_2-5-1-sql执行频率" class="header-anchor">#</a> 2.5.1 SQL执行频率</h4> <p>MySQL 客户端连接成功后，通过 show [session|global] status 命令可以提供服务器状态信息。通过如下指令，可以查看当前数据库的INSERT、UPDATE、DELETE、SELECT的访问频次：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- session 是查看当前会话 ;</span>
<span class="token comment">-- global 是查询全局数据 ;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Com_______'</span><span class="token punctuation">;</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Com_______'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token operator">|</span> Com_backup    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_binlog    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_commit    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_delete    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_insert    <span class="token operator">|</span> <span class="token number">1119203</span> <span class="token operator">|</span>
<span class="token operator">|</span> Com_repair    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_revoke    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_select    <span class="token operator">|</span> <span class="token number">134</span>     <span class="token operator">|</span>
<span class="token operator">|</span> Com_signal    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_update    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_xa_end    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>Com_delete: 删除次数</p> <p>Com_insert: 插入次数</p> <p>Com_select: 查询次数</p> <p>Com_update: 更新次数</p> <p>我们可以在当前数据库再执行几次查询操作，然后再次查看执行频次，看看 Com_select 参数会不会变化。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'Com_______'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token operator">|</span> Com_backup    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_binlog    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_commit    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_delete    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_insert    <span class="token operator">|</span> <span class="token number">1152203</span> <span class="token operator">|</span>
<span class="token operator">|</span> Com_repair    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_revoke    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_select    <span class="token operator">|</span> <span class="token number">134</span>     <span class="token operator">|</span>
<span class="token operator">|</span> Com_signal    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_update    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">|</span> Com_xa_end    <span class="token operator">|</span> <span class="token number">0</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+---------+</span>
<span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.001</span> sec<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>通过上述指令，我们可以查看到当前数据库到底是以查询为主，还是以增删改为主，从而为数据库优化提供参考依据。 如果是以增删改为主，我们可以考虑不对其进行索引的优化。 如果是以</p> <p>查询为主，那么就要考虑对数据库的索引进行优化了。</p></blockquote> <p>那么通过查询SQL的执行频次，我们就能够知道当前数据库到底是增删改为主，还是查询为主。 那假如说是以查询为主，我们又该如何定位针对于那些查询语句进行优化呢？ 次数我们可以借助于慢查询日志。</p> <p>接下来，我们就来介绍一下MySQL中的慢查询日志。</p> <h4 id="_2-5-2-慢查询日志"><a href="#_2-5-2-慢查询日志" class="header-anchor">#</a> 2.5.2 慢查询日志</h4> <p>慢查询日志记录了所有执行时间超过指定参数（long_query_time，单位：秒，默认10秒）的所有SQL语句的日志。</p> <p>MySQL的慢查询日志默认没有开启，我们可以查看一下系统变量 slow_query_log。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'slow_query_log'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> Variable_name  <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> slow_query_log <span class="token operator">|</span> <span class="token keyword">OFF</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'slow_query_log'</span>\G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Variable_name: slow_query_log
        <span class="token keyword">Value</span>: <span class="token keyword">OFF</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

ERROR: <span class="token keyword">No</span> query specified
</code></pre></div><p>如果要开启慢查询日志，需要在MySQL的配置文件（/etc/my.cnf）中配置如下信息：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment"># 开启MySQL慢日志查询开关</span>
<span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 设置慢日志的时间为2秒，SQL语句执行时间超过2秒，就会视为慢查询，记录慢查询日志</span>
<span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre></div><p>配置完毕之后，通过以下指令重新启动MySQL服务器进行测试，查看慢日志文件中记录的信息/var/lib/mysql/localhost-slow.log。</p> <p>然后，再次查看开关情况，慢查询日志就已经打开了。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'slow_query_log'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> Variable_name  <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token operator">|</span> slow_query_log <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'slow_query_log'</span>\G<span class="token punctuation">;</span>
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
Variable_name: slow_query_log
        <span class="token keyword">Value</span>: <span class="token keyword">ON</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p><strong>测试：</strong></p> <p>A.  执行如下SQL语句 ：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span> <span class="token comment">-- 这条SQL执行效率比较高, 执行耗时 0.00sec</span>

<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_sku<span class="token punctuation">;</span> <span class="token comment">-- 由于tb_sku表中, 预先存入了1000w的记录, count一次,耗时13.35sec</span>
</code></pre></div><p>B.  检查慢查询日志 ：</p> <p>最终我们发现，在慢查询日志中，只会记录执行时间超多我们预设时间（2s）的SQL，执行较快的SQL 是不会记录的。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010844336.png" alt="image-20220701003703523"></p> <p>那这样，通过慢查询日志，就可以定位出执行效率比较低的SQL，从而有针对性的进行优化。</p> <h4 id="_2-5-3-profile详情"><a href="#_2-5-3-profile详情" class="header-anchor">#</a> 2.5.3 profile详情</h4> <p>show profiles 能够在做SQL优化时帮助我们了解时间都耗费到哪里去了。通过have_profiling 参数，能够看到当前MySQL是否支持profile操作：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> @<span class="token variable">@have_profiling</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> @<span class="token variable">@have_profiling</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token operator">|</span> YES              <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>可以看到，当前MySQL是支持 profile操作的，但是开关是关闭的。可以通过set语句在 session/global级别开启profiling：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> profiling <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>开关已经打开了，接下来，我们所执行的SQL语句，都会被MySQL记录，并记录执行时间消耗到哪儿去了。 我们直接执行如下的SQL语句：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'白起'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_sku<span class="token punctuation">;</span>
</code></pre></div><p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 查看每一条SQL的耗时基本情况</span>
<span class="token keyword">show</span> profiles<span class="token punctuation">;</span>

<span class="token comment">-- 查看指定query_id的SQL语句各个阶段的耗时情况</span>
<span class="token keyword">show</span> profile <span class="token keyword">for</span> query query_id<span class="token punctuation">;</span>

<span class="token comment">-- 查看指定query_id的SQL语句CPU的使用情况</span>
<span class="token keyword">show</span> profile cpu <span class="token keyword">for</span> query query_id<span class="token punctuation">;</span>
</code></pre></div><p>查看每一条SQL的耗时情况:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> profiles<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------+</span>
<span class="token operator">|</span> Query_ID <span class="token operator">|</span> Duration   <span class="token operator">|</span> Query                                       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------+</span>
<span class="token operator">|</span>        <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">0.00014831</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span>          <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">0.00037277</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">'白起'</span>   <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">3</span> <span class="token operator">|</span> <span class="token number">0.00016053</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span>          <span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">0.00015029</span> <span class="token operator">|</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span>          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+------------+---------------------------------------------+</span>
<span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>查看指定SQL各个阶段的耗时情况 :</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Status</span>                 <span class="token operator">|</span> Duration <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Starting</span>               <span class="token operator">|</span> <span class="token number">0.000035</span> <span class="token operator">|</span>
<span class="token operator">|</span> checking permissions   <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> Opening <span class="token keyword">tables</span>         <span class="token operator">|</span> <span class="token number">0.000022</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">After</span> opening <span class="token keyword">tables</span>   <span class="token operator">|</span> <span class="token number">0.000004</span> <span class="token operator">|</span>
<span class="token operator">|</span> System <span class="token keyword">lock</span>            <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">table</span> <span class="token keyword">lock</span>             <span class="token operator">|</span> <span class="token number">0.000003</span> <span class="token operator">|</span>
<span class="token operator">|</span> init                   <span class="token operator">|</span> <span class="token number">0.000018</span> <span class="token operator">|</span>
<span class="token operator">|</span> Optimizing             <span class="token operator">|</span> <span class="token number">0.000010</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Statistics</span>             <span class="token operator">|</span> <span class="token number">0.000025</span> <span class="token operator">|</span>
<span class="token operator">|</span> Preparing              <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> Unlocking <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> Preparing              <span class="token operator">|</span> <span class="token number">0.000006</span> <span class="token operator">|</span>
<span class="token operator">|</span> Executing              <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> Sending <span class="token keyword">data</span>           <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">End</span> <span class="token keyword">of</span> <span class="token keyword">update</span> <span class="token keyword">loop</span>     <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> Query <span class="token keyword">end</span>              <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Commit</span>                 <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>         <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> Unlocking <span class="token keyword">tables</span>       <span class="token operator">|</span> <span class="token number">0.000000</span> <span class="token operator">|</span>
<span class="token operator">|</span> closing <span class="token keyword">tables</span>         <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">Starting</span> cleanup       <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">|</span> Freeing items          <span class="token operator">|</span> <span class="token number">0.000002</span> <span class="token operator">|</span>
<span class="token operator">|</span> Updating <span class="token keyword">status</span>        <span class="token operator">|</span> <span class="token number">0.000009</span> <span class="token operator">|</span>
<span class="token operator">|</span> Reset <span class="token keyword">for</span> <span class="token keyword">next</span> command <span class="token operator">|</span> <span class="token number">0.000001</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------+----------+</span>
<span class="token number">24</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-5-4-explain"><a href="#_2-5-4-explain" class="header-anchor">#</a> 2.5.4 explain</h4> <p>EXPLAIN 或者 DESC命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序。语法:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- 直接在select语句之前加上关键字 explain / desc</span>
<span class="token keyword">EXPLAIN</span> <span class="token keyword">SELECT</span> 字段列表 <span class="token keyword">FROM</span> 表名 <span class="token keyword">WHERE</span> 条件 <span class="token punctuation">;</span>
</code></pre></div><p>Explain 执行计划中各个字段的含义:</p> <table><thead><tr><th><strong>字段</strong></th> <th><strong>含义</strong></th></tr></thead> <tbody><tr><td>id</td> <td>select查询的序列号，表示查询中执行select子句或者是操作表的顺序  (id相同，执行顺序从上到下；id不同，值越大，越先执行)。</td></tr> <tr><td>select_type</td> <td>表示  SELECT 的类型，常见的取值有 SIMPLE（简单表，即不使用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、  UNION（UNION  中的第二个或者后面的查询语句）、  SUBQUERY（SELECT/WHERE之后包含了子查询）等</td></tr> <tr><td>type</td> <td>表示连接类型，性能由好到差的连接类型为NULL、system、const、  eq_ref、ref、range、  index、all 。</td></tr> <tr><td>possible_key</td> <td>显示可能应用在这张表上的索引，一个或多个。</td></tr> <tr><td>key</td> <td>实际使用的索引，如果为NULL，则没有使用索引。</td></tr> <tr><td>key_len</td> <td>表示索引中使用的字节数， 该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下， 长度越短越好 。</td></tr> <tr><td>rows</td> <td>MySQL认为必须要执行查询的行数，在innodb引擎的表中，是一个估计值，可能并不总是准确的。</td></tr> <tr><td>filtered</td> <td>表示返回结果的行数占需读取行数的百分比，  filtered 的值越大越好。</td></tr></tbody></table> <h4 id="_2-6-索引使用"><a href="#_2-6-索引使用" class="header-anchor">#</a> 2.6 索引使用</h4> <h5 id="_2-6-1-验证索引效率"><a href="#_2-6-1-验证索引效率" class="header-anchor">#</a> 2.6.1 验证索引效率</h5> <p>在讲解索引的使用原则之前，先通过一个简单的案例，来验证一下索引，看看是否能够通过索引来提升数据查询性能。在演示的时候，我们还是使用之前准备的一张表 tb_sku , 在这张表中准备了1000w 的记录。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845230.png" alt="image-20220701004413659"></p> <p>这张表中id为主键，有主键索引，而其他字段是没有建立索引的。 我们先来查询其中的一条记录，看看里面的字段情况，执行如下SQL：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tb_sku <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span>\G<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845696.png" alt="image-20220701004435285"></p> <p>可以看到即使有1000w的数据,根据id进行数据查询,性能依然很快，因为主键id是有索引的。 那么接下来，我们再来根据 sn 字段进行查询，执行如下SQL：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tb_sku <span class="token keyword">WHERE</span> sn <span class="token operator">=</span> <span class="token string">'100000003145001'</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845866.png" alt="image-20220701004525933"></p> <p>我们可以看到根据sn字段进行查询，查询返回了一条数据，结果耗时 20.78sec，就是因为sn没有索引，而造成查询效率很低。</p> <p>那么我们可以针对于sn字段，建立一个索引，建立了索引之后，我们再次根据sn进行查询，再来看一下查询耗时情况。</p> <p>创建索引：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> idx_sku_sn <span class="token keyword">on</span> tb_sku<span class="token punctuation">(</span>sn<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845007.png" alt="image-20220701004703802"></p> <p>然后再次执行相同的SQL语句，再次查看SQL的耗时。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_sku <span class="token keyword">where</span> sn <span class="token operator">=</span> <span class="token string">'100000003145001'</span><span class="token punctuation">;</span>
</code></pre></div><p>我们明显会看到，sn字段建立了索引之后，查询性能大大提升。建立索引前后，查询耗时都不是一个数量级的。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845000.png" alt="image-20220701004711233"></p> <h5 id="_2-6-2-最左前缀法则"><a href="#_2-6-2-最左前缀法则" class="header-anchor">#</a> 2.6.2 最左前缀法则</h5> <p>如果索引了多列（联合索引），要遵守最左前 法则。最左前 法则指的是查询从索引的最左列开始，并且不跳过索引中的列。如果跳跃某一列，索引将会部分失效(后面的字段索引失效)。</p> <p>以 tb_user 表为例，我们先来查看一下之前 tb_user 表所创建的索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>在 tb_user 表中，有一个联合索引，这个联合索引涉及到三个字段，顺序分别为：profession，age，status。对于最左前 法则指的是，查询时，最左变的列，也就是profession必须存在，否则索引全部失效。</p> <p>而且中间不能跳过某一列，否则该列后面的字段索引将失效。 接下来，我们来演示几组案例，看一下具体的执行计划：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>


MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">49</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>以上的这三组测试中，我们发现只要联合索引最左边的字段 profession存在，索引就会生效，只不过索引的长度不同。 而且由以上三组测试，我们也可以推测出profession字段索引长度为47、age 字段索引长度为2、status字段索引长度为5。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>而通过上面的这两组测试，我们也可以看到索引并未生效，原因是因为不满足最左前 法则，联合索引最左边的列profession不存在。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>上述的SQL查询时，存在profession字段，最左边的列是存在的，索引满足最左前 法则的基本条件。但是查询时，跳过了age这个列，所以后面的列索引是不会使用的，也就是索引部分生效，所以索引的长度就是47。</p> <blockquote><p>思考题：当执行SQL语句: explain select * from tb_user where age = 31 and status = '0' and profession = '软件工程'； 时，是否满足最左前缀法则，走不走 上述的联合索引，索引长度？</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">and</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>可以看到，是完全满足最左前缀法则的，索引长度54，联合索引是生效的。 注意 ： 最左前缀法则中指的最左边的列，是指在查询时，联合索引的最左边的字段(即是 第一个字段)必须存在，与我们编写SQL时，条件编写的先后顺序无关。</p></blockquote> <h5 id="_2-6-3-范围查询"><a href="#_2-6-3-范围查询" class="header-anchor">#</a> 2.6.3 范围查询</h5> <p>联合索引中，出现范围查询(&gt;,&lt;)，范围查询右侧的列索引失效。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">&gt;</span> <span class="token number">30</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> range <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">49</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>当范围查询使用&gt; 或 &lt; 时，走联合索引了，但是索引的长度为49，就说明范围查询右边的status字段是没有走索引的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">&gt;=</span> <span class="token number">30</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> range <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">2</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>当范围查询使用&gt;= 或 &lt;= 时，走联合索引了，但是索引的长度为54，就说明所有的字段都是走索引的。所以，在业务允许的情况下，尽可能的使用类似于 &gt;= 或&lt;= 这类的范围查询，而避免使用 &gt; 或 &lt;。</p> <h5 id="_2-6-4-索引失效情况"><a href="#_2-6-4-索引失效情况" class="header-anchor">#</a> 2.6.4 索引失效情况</h5> <p><strong>2.6.4.1 索引列运算</strong> 不要在索引列上进行运算操作， 索引将失效。</p> <p>在tb_user表中，除了前面介绍的联合索引之外，还有一个索引，是phone字段的单列索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>A.  当根据phone字段进行等值匹配查询时, 索引生效。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'17799990015'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>            <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> const <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token number">46</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>B.  当根据phone字段进行函数运算操作之后，索引失效。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> substring<span class="token punctuation">(</span>phone<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'15'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p><strong>2.6.4.2 字符串不加引号</strong></p> <p>字符串类型字段使用时，不加引号，索引将失效。</p> <p>接下来，我们通过两组示例，来看看对于字符串类型的字段，加单引号与不加单引号的区别：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">49</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'17799990015'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>            <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> const <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token number">46</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+-------+------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token number">17799990015</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>经过上面两组示例，我们会明显的发现，如果字符串不加单引号，对于查询结果，没什么影响，但是数据库存在隐式类型转换，索引将失效。</p> <p><strong>2.6.4.3 模糊查询</strong></p> <p>如果仅仅是尾部模糊匹配，索引不会失效。如果是头部模糊匹配，索引失效。</p> <p>接下来，我们来看一下这三条SQL语句的执行效果，查看一下其执行计划：</p> <p>由于下面查询语句中，都是根据profession字段查询，符合最左前 法则，联合索引是可以生效的，我们主要看一下，模糊查询时，%加在关键字之前，和加在关键字之后的影响。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">like</span> <span class="token string">'软件%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> range <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------------+----------------------+---------+------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">like</span> <span class="token string">'%工程'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">like</span> <span class="token string">'%工%'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token boolean">NULL</span>          <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>经过上述的测试，我们发现，在like模糊查询中，在关键字后面加%，索引可以生效。而如果在关键字前面加了%，索引将会失效。</p> <p><strong>3.6.4.4 or连接条件</strong></p> <p>用or分割开的条件， 如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">or</span> age <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+---------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'17799990017'</span> <span class="token operator">or</span> age <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>由于age没有索引，所以即使id、phone有索引，索引也会失效。所以需要针对于age也要建立索引。</p> <p>然后，我们可以对age字段建立索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_age <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.003</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>
</code></pre></div><p>建立了索引之后，我们再次执行上述的SQL语句，看看前后执行计划的变化。</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845194.png" alt="image-20220701010509595"></p> <p>最终，我们发现，当or连接的条件，左右两侧字段都有索引时，索引才会生效。</p> <p><strong>3.6.4.5 数据分布影响</strong></p> <p>如果MySQL评估使用索引比全表更慢，则不使用索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">&gt;=</span> <span class="token string">'17799990015'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">&gt;=</span> <span class="token string">'17799999015'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys  <span class="token operator">|</span> <span class="token keyword">key</span>            <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> range <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token number">46</span>      <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+----------------+----------------+---------+------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>经过测试我们发现，相同的SQL语句，只是传入的字段值不同，最终的执行计划也完全不一样，这是为什么呢？</p> <p>就是因为MySQL在查询时，会评估使用索引的效率与走全表扫描的效率，如果走全表扫描更快，则放弃索引，走全表扫描。 因为索引是用来索引少量数据的，如果通过索引查询返回大批量的数据，则还不如走全表扫描来的快，此时索引就会失效。</p> <p>接下来，我们再来看看 is null 与 is not null 操作是否走索引。</p> <p>执行如下两条语句 ：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+------+---------+------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">24</span>   <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+------+---------+------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>最终我们看到，一模一样的SQL语句，先后执行了两次，结果查询计划是不一样的，为什么会出现这种现象，这是和数据库的数据分布有关系。查询时MySQL会评估，走索引快，还是全表扫描快，如果全表扫描更快，则放弃索引走全表扫描。 因此，is null 、is not null是否走索引，得具体情况具体分析，并不是固定的。</p> <h5 id="_2-6-5-sql提示"><a href="#_2-6-5-sql提示" class="header-anchor">#</a> 2.6.5 SQL提示</h5> <p>目前tb_user表的数据情况如下:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> name      <span class="token operator">|</span> phone       <span class="token operator">|</span> email                 <span class="token operator">|</span> profession                  <span class="token operator">|</span> age  <span class="token operator">|</span> gender <span class="token operator">|</span> <span class="token keyword">status</span> <span class="token operator">|</span> createtime          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> 吕布      <span class="token operator">|</span> <span class="token number">17799990000</span> <span class="token operator">|</span> lvbu666<span class="token variable">@163.com</span>       <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">23</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">6</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> 曹操      <span class="token operator">|</span> <span class="token number">17799990001</span> <span class="token operator">|</span> caocao666<span class="token variable">@qq.com</span>      <span class="token operator">|</span> 通讯工程                    <span class="token operator">|</span>   <span class="token number">33</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> 赵云      <span class="token operator">|</span> <span class="token number">17799990002</span> <span class="token operator">|</span> <span class="token number">17799990</span><span class="token variable">@139.com</span>      <span class="token operator">|</span> 英语                        <span class="token operator">|</span>   <span class="token number">34</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> 孙悟空    <span class="token operator">|</span> <span class="token number">17799990003</span> <span class="token operator">|</span> <span class="token number">17799990</span><span class="token variable">@sina.com</span>     <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">54</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">02</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> 花木兰    <span class="token operator">|</span> <span class="token number">17799990004</span> <span class="token operator">|</span> <span class="token number">19980729</span><span class="token variable">@sina.com</span>     <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">23</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> 大乔      <span class="token operator">|</span> <span class="token number">17799990005</span> <span class="token operator">|</span> daqiao666<span class="token variable">@sina.com</span>    <span class="token operator">|</span> 舞蹈                        <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">07</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> 露娜      <span class="token operator">|</span> <span class="token number">17799990006</span> <span class="token operator">|</span> luna_love<span class="token variable">@sina.com</span>    <span class="token operator">|</span> 应用数学                    <span class="token operator">|</span>   <span class="token number">24</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">08</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> 程咬金    <span class="token operator">|</span> <span class="token number">17799990007</span> <span class="token operator">|</span> chengyaojin<span class="token variable">@163.com</span>   <span class="token operator">|</span> 化工                        <span class="token operator">|</span>   <span class="token number">38</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">5</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> 项羽      <span class="token operator">|</span> <span class="token number">17799990008</span> <span class="token operator">|</span> xiaoyu666<span class="token variable">@qq.com</span>      <span class="token operator">|</span> 金属材料                    <span class="token operator">|</span>   <span class="token number">43</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> 白起      <span class="token operator">|</span> <span class="token number">17799990009</span> <span class="token operator">|</span> baiqi666<span class="token variable">@sina.com</span>     <span class="token operator">|</span> 机械工程及其自动化          <span class="token operator">|</span>   <span class="token number">27</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">16</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> 韩信      <span class="token operator">|</span> <span class="token number">17799990010</span> <span class="token operator">|</span> hanxin520<span class="token variable">@163.com</span>     <span class="token operator">|</span> 无机非金属材料工程          <span class="token operator">|</span>   <span class="token number">27</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">06</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">12</span> <span class="token operator">|</span> 荆轲      <span class="token operator">|</span> <span class="token number">17799990011</span> <span class="token operator">|</span> jingke123<span class="token variable">@163.com</span>     <span class="token operator">|</span> 会计                        <span class="token operator">|</span>   <span class="token number">29</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">11</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">13</span> <span class="token operator">|</span> 兰陵王    <span class="token operator">|</span> <span class="token number">17799990012</span> <span class="token operator">|</span> lanlinwang666<span class="token variable">@126.com</span> <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">44</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">09</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">14</span> <span class="token operator">|</span> 狂铁      <span class="token operator">|</span> <span class="token number">17799990013</span> <span class="token operator">|</span> kuangtie<span class="token variable">@sina.com</span>     <span class="token operator">|</span> 应用数学                    <span class="token operator">|</span>   <span class="token number">43</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">15</span> <span class="token operator">|</span> 貂蝉      <span class="token operator">|</span> <span class="token number">17799990014</span> <span class="token operator">|</span> <span class="token number">84958948374</span><span class="token variable">@qq.com</span>    <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">40</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">16</span> <span class="token operator">|</span> 妲己      <span class="token operator">|</span> <span class="token number">17799990015</span> <span class="token operator">|</span> <span class="token number">2783238293</span><span class="token variable">@qq.com</span>     <span class="token operator">|</span> 软件工程                    <span class="token operator">|</span>   <span class="token number">31</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">30</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">17</span> <span class="token operator">|</span> 芈月      <span class="token operator">|</span> <span class="token number">17799990016</span> <span class="token operator">|</span> xiaomin2001<span class="token variable">@sina.com</span>  <span class="token operator">|</span> 工业经济                    <span class="token operator">|</span>   <span class="token number">35</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2000</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">03</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">18</span> <span class="token operator">|</span> 嬴政      <span class="token operator">|</span> <span class="token number">17799990017</span> <span class="token operator">|</span> <span class="token number">8839434342</span><span class="token variable">@qq.com</span>     <span class="token operator">|</span> 化工                        <span class="token operator">|</span>   <span class="token number">38</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">08</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">19</span> <span class="token operator">|</span> 狄仁杰    <span class="token operator">|</span> <span class="token number">17799990018</span> <span class="token operator">|</span> jujiamlm8166<span class="token variable">@163.com</span>  <span class="token operator">|</span> 国际贸易                    <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">20</span> <span class="token operator">|</span> 安琪拉    <span class="token operator">|</span> <span class="token number">17799990019</span> <span class="token operator">|</span> jdodm1h<span class="token variable">@126.com</span>       <span class="token operator">|</span> 城市规划                    <span class="token operator">|</span>   <span class="token number">51</span> <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2001</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">21</span> <span class="token operator">|</span> 典韦      <span class="token operator">|</span> <span class="token number">17799990020</span> <span class="token operator">|</span> ycaunanjian<span class="token variable">@163.com</span>   <span class="token operator">|</span> 城市规划                    <span class="token operator">|</span>   <span class="token number">52</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">2</span>      <span class="token operator">|</span> <span class="token number">2000</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">22</span> <span class="token operator">|</span> 廉颇      <span class="token operator">|</span> <span class="token number">17799990021</span> <span class="token operator">|</span> lianpo321<span class="token variable">@126.com</span>     <span class="token operator">|</span> 土木工程                    <span class="token operator">|</span>   <span class="token number">19</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">3</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">18</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">23</span> <span class="token operator">|</span> 后羿      <span class="token operator">|</span> <span class="token number">17799990022</span> <span class="token operator">|</span> altycj2000<span class="token variable">@139.com</span>    <span class="token operator">|</span> 城市园林                    <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">0</span>      <span class="token operator">|</span> <span class="token number">2002</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">10</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">24</span> <span class="token operator">|</span> 姜子牙    <span class="token operator">|</span> <span class="token number">17799990023</span> <span class="token operator">|</span> <span class="token number">37483844</span><span class="token variable">@qq.com</span>       <span class="token operator">|</span> 工程造价                    <span class="token operator">|</span>   <span class="token number">29</span> <span class="token operator">|</span> <span class="token number">1</span>      <span class="token operator">|</span> <span class="token number">4</span>      <span class="token operator">|</span> <span class="token number">2003</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">00</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+-----------+-------------+-----------------------+-----------------------------+------+--------+--------+---------------------+</span>
<span class="token number">24</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>索引情况如下:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_age         <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>把上述的 idx_user_age, idx_email 这两个之前测试使用过的索引直接删除。</p> <p>A.  执行SQL : explain select * from tb_user where profession = '软件工程';</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>查询走了联合索引。</p> <p>B.  执行SQL，创建profession的单列索引：create index idx_user_pro on tb_user(profession);</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_pro <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>profession<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

</code></pre></div><p>C.  创建单列索引后，再次执行A中的SQL语句，查看执行计划，看看到底走哪个索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys        <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">47</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">4</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> condition <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+----------------------+----------------------+---------+-------+------+-----------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>测试结果，我们可以看到，possible_keys中 idx_user_pro_age_sta,idx_user_pro 这两个索引都可能用到，最终MySQL选择了idx_user_pro_age_sta索引。这是MySQL自动选择的结果。</p> <p>那么，我们能不能在查询的时候，自己来指定使用哪个索引呢？ 答案是肯定的，此时就可以借助于 MySQL的SQL提示来完成。 接下来，介绍一下SQL提示。</p> <p>SQL提示，是优化数据库的一个重要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p> <ul><li><code>use index ：</code> 建议MySQL使用哪一个索引完成此次查询（仅仅是建议，mysql内部还会再次进行评估）。</li> <li><code>ignore index ：</code> 忽略指定的索引。</li> <li><code>force index ：</code> 强制使用索引。</li></ul> <p>示例演示：</p> <p>A.  use index</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">use</span> <span class="token keyword">index</span><span class="token punctuation">(</span>idx_user_pro<span class="token punctuation">)</span> <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
</code></pre></div><p>B.  ignore index</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">ignore</span> <span class="token keyword">index</span><span class="token punctuation">(</span>idx_user_pro<span class="token punctuation">)</span> <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span><span class="token punctuation">;</span>
</code></pre></div><p>C.  force index</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">force</span> <span class="token keyword">index</span><span class="token punctuation">(</span>idx_user_pro<span class="token punctuation">)</span> <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件程'</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="_2-6-6-覆盖索引"><a href="#_2-6-6-覆盖索引" class="header-anchor">#</a> 2.6.6 覆盖索引</h5> <p>尽量使用覆盖索引，减少select *。 那么什么是覆盖索引呢？ 覆盖索引是指 查询使用了索引，并且需要返回的列，在该索引中已经全部能够找到 。接下来，我们来看一组SQL的执行计划，看看执行计划的差别，然后再来具体做一个解析。</p> <p>上述这几条SQL的执行结果为:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span> profession <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                                  <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta<span class="token punctuation">,</span>idx_user_age<span class="token punctuation">,</span>idx_user_pro <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>


MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>profession<span class="token punctuation">,</span>age<span class="token punctuation">,</span> <span class="token keyword">status</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys                                  <span class="token operator">|</span> <span class="token keyword">key</span>                  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref               <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra                    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref  <span class="token operator">|</span> idx_user_pro_age_sta<span class="token punctuation">,</span>idx_user_age<span class="token punctuation">,</span>idx_user_pro <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span> <span class="token number">54</span>      <span class="token operator">|</span> const<span class="token punctuation">,</span>const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------+------------------------------------------------+----------------------+---------+-------------------+------+--------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>


MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>profession<span class="token punctuation">,</span>age<span class="token punctuation">,</span> <span class="token keyword">status</span><span class="token punctuation">,</span> name <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+--------+---------------------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>       <span class="token operator">|</span> possible_keys                                  <span class="token operator">|</span> <span class="token keyword">key</span>                       <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> Extra                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+--------+---------------------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref<span class="token operator">|</span>filter <span class="token operator">|</span> idx_user_pro_age_sta<span class="token punctuation">,</span>idx_user_age<span class="token punctuation">,</span>idx_user_pro <span class="token operator">|</span> idx_user_age<span class="token operator">|</span>idx_user_pro <span class="token operator">|</span> <span class="token number">2</span><span class="token operator">|</span><span class="token number">47</span>    <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> rowid filter <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+--------+---------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>


MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> profession <span class="token operator">=</span> <span class="token string">'软件工程'</span> <span class="token operator">and</span> age <span class="token operator">=</span> <span class="token number">31</span> <span class="token operator">and</span> <span class="token keyword">status</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+---------+---------------------------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>       <span class="token operator">|</span> possible_keys                                  <span class="token operator">|</span> <span class="token keyword">key</span>                       <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span>    <span class="token operator">|</span> Extra                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+---------+---------------------------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> ref<span class="token operator">|</span>filter <span class="token operator">|</span> idx_user_pro_age_sta<span class="token punctuation">,</span>idx_user_age<span class="token punctuation">,</span>idx_user_pro <span class="token operator">|</span> idx_user_age<span class="token operator">|</span>idx_user_pro <span class="token operator">|</span> <span class="token number">2</span><span class="token operator">|</span><span class="token number">47</span>    <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">17</span><span class="token operator">%</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> rowid filter <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+------------+------------------------------------------------+---------------------------+---------+-------+---------+---------------------------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>从上述的执行计划我们可以看到，这四条SQL语句的执行计划前面所有的指标都是一样的，看不出来差异。但是此时，我们主要关注的是后面的Extra，前面两天SQL的结果为 Using where; Using Index ; 而后面两条SQL的结果为: Using index condition 。</p> <table><thead><tr><th><strong>Extra</strong></th> <th><strong>含义</strong></th></tr></thead> <tbody><tr><td>Using  where; Using  Index</td> <td>查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据</td></tr> <tr><td>Using  index condition</td> <td>查找使用了索引，但是需要回表查询数据</td></tr></tbody></table> <p>因为，在tb_user表中有一个联合索引 idx_user_pro_age_sta，<code>该索引关联了三个字段profession、age、status</code>，而这个索引也是一个二级索引，所以叶子节点下面挂的是这一行的主键id。 <code>所以当我们查询返回的数据在 id、profession、age、status 之中，则直接走二级索引直接返回数据了</code>。 如果超出这个范围，就需要拿到主键id，再去扫描聚集索引，再获取额外的数据了，这个过程就是回表。 而我们如果一直使用select * 查询返回所有字段值，很容易就会造成回表查询（除非是根据主键查询，此时只会扫描聚集索引）。</p> <p>为了大家更清楚的理解，什么是覆盖索引，什么是回表查询，我们一起再来看下面的这组SQL的执行过程。</p> <p>A.  表结构及索引示意图:</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845552.png" alt="image-20220701011902782"></p> <p>id是主键，是一个聚集索引。 name字段建立了普通索引，是一个二级索引（辅助索引）。</p> <p>B.  执行SQL : select * from tb_user where id = 2;</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845376.png" alt="image-20220701011909032"></p> <p>根据id查询，直接走聚集索引查询，一次索引扫描，直接返回数据，性能高。</p> <p>C.  执行SQL：selet id,name from tb_user where name = 'Arm';</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845612.png" alt="image-20220701011916754"></p> <p>虽然是根据name字段查询，查询二级索引，但是由于查询返回在字段为 id，name，在name的二级索引中，这两个值都是可以直接获取到的，因为覆盖索引，所以不需要回表查询，性能高。</p> <p>D.  执行SQL：selet id,name,gender from tb_user where name = 'Arm';</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845680.png" alt="image-20220701011922218"></p> <p>由于在name的二级索引中，不包含gender，所以，需要两次索引扫描，也就是需要回表查询，性能相对较差一点。</p> <blockquote><p>思考题：</p></blockquote> <p>一张表, 有四个字段(id, username, password, status), 由于数据量大, 需要对以下SQL语句进行优化, 该如何进行才是最优方案:</p> <p>select id,username,password from tb_user where username = 'itcast';</p> <p>答案: 针对于 username, password建立联合索引, sql为:</p> <p>create index idx_user_name_pass on tb_user(username,password);</p> <p>这样可以避免上述的SQL语句，在查询的过程中，出现回表查询。</p> <h5 id="_2-6-7-前缀索引"><a href="#_2-6-7-前缀索引" class="header-anchor">#</a> 2.6.7 前缀索引</h5> <p>当字段类型为字符串（varchar，text，longtext等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO， 影响查询效率。此时可以只将字符串的一部分前 ，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p> <p>1). 语法</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">index</span> idx_xxxx <span class="token keyword">on</span> table_name<span class="token punctuation">(</span><span class="token keyword">column</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>示例:</p> <p>为tb_user表的email字段，建立长度为5的前 索引。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">index</span> idx_email_5 <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>email<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span>  tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_age         <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro         <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email_5          <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">10</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>2). 前 长度</p> <p>可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高， 唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> email<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_user <span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> substring<span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> tb_user <span class="token punctuation">;</span>
</code></pre></div><p>3). 前 索引的查询流程</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845497.png" alt="image-20220701012228759"></p> <h5 id="_2-6-8-单列索引与联合索引"><a href="#_2-6-8-单列索引与联合索引" class="header-anchor">#</a> 2.6.8 单列索引与联合索引</h5> <p>单列索引：即一个索引只包含单个列。联合索引：即一个索引包含了多个列。</p> <p>我们先来看看 tb_user 表中目前的索引情况:</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span>  tb_user<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>   <span class="token operator">|</span> Non_unique <span class="token operator">|</span> Key_name             <span class="token operator">|</span> Seq_in_index <span class="token operator">|</span> Column_name <span class="token operator">|</span> Collation <span class="token operator">|</span> Cardinality <span class="token operator">|</span> Sub_part <span class="token operator">|</span> Packed <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> Index_type <span class="token operator">|</span> <span class="token keyword">Comment</span> <span class="token operator">|</span> Index_comment <span class="token operator">|</span> Ignored <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">PRIMARY</span>              <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> id          <span class="token operator">|</span> A         <span class="token operator">|</span>           <span class="token number">2</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">0</span> <span class="token operator">|</span> idx_user_phone       <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> phone       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">2</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro_age_sta <span class="token operator">|</span>            <span class="token number">3</span> <span class="token operator">|</span> <span class="token keyword">status</span>      <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email            <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_name        <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> name        <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span>      <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_age         <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> age         <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_user_pro         <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> profession  <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>     <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">|</span> tb_user <span class="token operator">|</span>          <span class="token number">1</span> <span class="token operator">|</span> idx_email_5          <span class="token operator">|</span>            <span class="token number">1</span> <span class="token operator">|</span> email       <span class="token operator">|</span> A         <span class="token operator">|</span>          <span class="token number">24</span> <span class="token operator">|</span>        <span class="token number">5</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>   <span class="token operator">|</span> YES  <span class="token operator">|</span> <span class="token keyword">BTREE</span>      <span class="token operator">|</span>         <span class="token operator">|</span>               <span class="token operator">|</span> <span class="token keyword">NO</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------+----------------------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+</span>
<span class="token number">10</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>
</code></pre></div><p>在查询出来的索引中，既有单列索引，又有联合索引。</p> <p>接下来，我们来执行一条SQL语句，看看其执行计划：</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>name <span class="token keyword">from</span> tb_user <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'17799990010'</span> <span class="token operator">and</span> name <span class="token operator">=</span> <span class="token string">'韩信'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+------------------------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys                <span class="token operator">|</span> <span class="token keyword">key</span>            <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+------------------------------+----------------+---------+-------+------+-------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> const <span class="token operator">|</span> idx_user_phone<span class="token punctuation">,</span>idx_user_name <span class="token operator">|</span> idx_user_phone <span class="token operator">|</span> <span class="token number">46</span>      <span class="token operator">|</span> const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+------------------------------+----------------+---------+-------+------+-------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>通过上述执行计划我们可以看出来，在and连接的两个字段 phone、name上都是有单列索引的，但是最终mysql只会选择一个索引，也就是说，只能走一个字段的索引，此时是会回表查询的。</p> <p>紧接着，我们再来创建一个phone和name字段的联合索引来查询一下执行计划。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">unique</span> <span class="token keyword">index</span> idx_user_phone_name <span class="token keyword">on</span> tb_user<span class="token punctuation">(</span>phone<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.004</span> sec<span class="token punctuation">)</span>
Records: <span class="token number">0</span>  Duplicates: <span class="token number">0</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span>

MariaDB <span class="token punctuation">[</span>itheima<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token keyword">explain</span> <span class="token keyword">select</span> id<span class="token punctuation">,</span>phone<span class="token punctuation">,</span>name <span class="token keyword">from</span> tb_user <span class="token keyword">use</span> <span class="token keyword">index</span><span class="token punctuation">(</span>idx_user_phone_name<span class="token punctuation">)</span> <span class="token keyword">where</span> phone <span class="token operator">=</span> <span class="token string">'17799990010'</span> <span class="token operator">and</span> name <span class="token operator">=</span> <span class="token string">'韩信'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+---------------------+---------------------+---------+-------------+------+-------------+</span>
<span class="token operator">|</span> id   <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>   <span class="token operator">|</span> <span class="token keyword">type</span>  <span class="token operator">|</span> possible_keys       <span class="token operator">|</span> <span class="token keyword">key</span>                 <span class="token operator">|</span> key_len <span class="token operator">|</span> ref         <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> Extra       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+---------------------+---------------------+---------+-------------+------+-------------+</span>
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tb_user <span class="token operator">|</span> const <span class="token operator">|</span> idx_user_phone_name <span class="token operator">|</span> idx_user_phone_name <span class="token operator">|</span> <span class="token number">248</span>     <span class="token operator">|</span> const<span class="token punctuation">,</span>const <span class="token operator">|</span> <span class="token number">1</span>    <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">index</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-------------+---------+-------+---------------------+---------------------+---------+-------------+------+-------------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.000</span> sec<span class="token punctuation">)</span>

</code></pre></div><p>此时，查询时，就走了联合索引，而在联合索引中包含 phone、name的信息，在叶子节点下挂的是对应的主键id，所以查询是无需回表查询的。</p> <blockquote><p>在业务场景中，如果存在多个查询条件，考虑针对于查询字段建立索引时，建议建立联合索引，</p> <p>而非单列索引。</p></blockquote> <p>如果查询使用的是联合索引，具体的结构示意图如下：</p> <p><img src="https://raw.githubusercontent.com/isicman/image/main/img/202207010845416.png" alt="image-20220701011130262"></p> <h4 id="_2-7-索引设计原则"><a href="#_2-7-索引设计原则" class="header-anchor">#</a> 2.7 索引设计原则</h4> <ol><li><p>针对于数据量较大，且查询比较频繁的表建立索引。</p></li> <li><p>针对于常作为查询条件（where）、排序（order by）、分组（group by）操作的字段建立索引。</p></li> <li><p>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</p></li> <li><p>如果是字符串类型的字段，字段的长度较长，可以针对于字段的特点，建立前 索引。</p></li> <li><p>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率。</p></li> <li><p>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价也就越大，会影响增删改的效率。</p></li> <li><p>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含</p></li> <li><p>NULL值时，它可以更好地确定哪个索引最有效地用于查询。</p></li></ol></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/12/19, 22:18:59</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/exam/pages/904c55/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MySQL的事务</div></a> <a href="/exam/pages/f5abb7/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Java面向对象(上)</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/exam/pages/904c55/" class="prev">MySQL的事务</a></span> <span class="next"><a href="/exam/pages/f5abb7/">Java面向对象(上)</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:2756864799@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Kryust" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>ZYH</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/exam/assets/js/app.1e2999bd.js" defer></script><script src="/exam/assets/js/2.d32ca216.js" defer></script><script src="/exam/assets/js/19.34a4f0df.js" defer></script>
  </body>
</html>
